import{a as S,b as f}from"./chunk-WQL2BJYL.js";import{c as d}from"./chunk-VTLVKXBE.js";import{c,g as h,lb as m,n as l,r as u,u as n,v as o}from"./chunk-2VKWM52Q.js";import{f as i}from"./chunk-RW4GY4BD.js";var P=(()=>{let r=class r{constructor(t,s){this.platform=t,this.androidPermissions=s}checkAndRequestBluetoothPermissions(){return i(this,null,function*(){if(!this.platform.is("android"))return!0;try{let t=yield this.hasPermission(this.androidPermissions.PERMISSION.BLUETOOTH_SCAN),s=yield this.hasPermission(this.androidPermissions.PERMISSION.BLUETOOTH_CONNECT),a=yield this.hasPermission(this.androidPermissions.PERMISSION.ACCESS_FINE_LOCATION);return t&&s&&a?!0:(yield this.androidPermissions.requestPermissions([this.androidPermissions.PERMISSION.BLUETOOTH_SCAN,this.androidPermissions.PERMISSION.BLUETOOTH_CONNECT,this.androidPermissions.PERMISSION.ACCESS_FINE_LOCATION])).hasPermission}catch(t){return console.error("Error checking or requesting permissions",t),!1}})}hasPermission(t){return i(this,null,function*(){return(yield this.androidPermissions.checkPermission(t)).hasPermission})}};r.\u0275fac=function(s){return new(s||r)(o(m),o(f))},r.\u0275prov=n({token:r,factory:r.\u0275fac,providedIn:"root"});let e=r;return e})();var p="default_printer",y=(()=>{let r=class r{constructor(t,s,a){this.bluetoothSerial=t,this.toastCtrl=s,this.permissionsService=a,this.connectionStatus=new c(!1),this.bluetoothSerial.isConnected().then(()=>this.connectionStatus.next(!0),()=>this.connectionStatus.next(!1))}scanForDevices(){return i(this,null,function*(){try{return(yield this.permissionsService.checkAndRequestBluetoothPermissions())?(yield this.bluetoothSerial.isEnabled(),yield this.bluetoothSerial.discoverUnpaired()):(this.showToast("Permisos necesarios no concedidos."),[])}catch(t){return console.error("Error scanning for bluetooth devices",t),this.showToast("Error al escanear. Verifique que el Bluetooth y la Localizaci\xF3n est\xE9n activados."),[]}})}connect(t){return this.bluetoothSerial.connect(t).pipe(u(()=>(this.connectionStatus.next(!0),h(void 0))),l(s=>{throw console.error("Error connecting to device",s),this.showToast(`Error al conectar: ${s}`),this.connectionStatus.next(!1),s}))}disconnect(){return i(this,null,function*(){try{yield this.bluetoothSerial.disconnect(),this.connectionStatus.next(!1)}catch(t){console.error("Error disconnecting",t),this.showToast("Error al desconectar la impresora.")}})}print(t){return i(this,null,function*(){try{yield this.bluetoothSerial.write(t)}catch(s){throw console.error("Error printing data",s),this.showToast("Error al enviar datos a la impresora."),s}})}saveDefaultPrinter(t){return localStorage.setItem(p,JSON.stringify(t)),Promise.resolve()}getDefaultPrinter(){let t=localStorage.getItem(p);return Promise.resolve(t?JSON.parse(t):null)}checkConnectionStatus(){return this.connectionStatus.asObservable()}isConnected(){return i(this,null,function*(){try{return yield this.bluetoothSerial.isConnected(),!0}catch{return!1}})}showToast(t){return i(this,null,function*(){(yield this.toastCtrl.create({message:t,duration:3e3,position:"bottom"})).present()})}};r.\u0275fac=function(s){return new(s||r)(o(S),o(d),o(P))},r.\u0275prov=n({token:r,factory:r.\u0275fac,providedIn:"root"});let e=r;return e})();export{y as a};
