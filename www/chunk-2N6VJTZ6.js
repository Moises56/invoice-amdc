import{a as I}from"./chunk-HENECHRK.js";import{Pa as c,Qa as g,c as d,s as o,u as h,w as m}from"./chunk-5JVX3F6S.js";var j=(()=>{let i=class i{constructor(){this.http=m(g),this.apiUrl=`${I.apiUrl}/facturas`,this.facturasSubject=new d([]),this.facturas$=this.facturasSubject.asObservable()}getFacturas(t={}){let a=new c;return t.page&&(a=a.set("page",t.page.toString())),t.limit&&(a=a.set("limit",t.limit.toString())),t.search&&(a=a.set("search",t.search)),t.estado&&(a=a.set("estado",t.estado)),t.localId&&(a=a.set("localId",t.localId)),t.mercadoId&&(a=a.set("mercadoId",t.mercadoId)),t.mes&&(a=a.set("mes",t.mes)),t.anio&&(a=a.set("anio",t.anio.toString())),t.startDate&&(a=a.set("startDate",t.startDate)),t.endDate&&(a=a.set("endDate",t.endDate)),this.http.get(this.apiUrl,{params:a})}getFacturaById(t){return this.http.get(`${this.apiUrl}/${t}`)}createFactura(t){return this.http.post(this.apiUrl,t).pipe(o(a=>{if(a.data){let e=this.facturasSubject.value;this.facturasSubject.next([...e,a.data])}}))}updateFactura(t,a){return this.http.patch(`${this.apiUrl}/${t}`,a).pipe(o(e=>{if(e.data){let r=this.facturasSubject.value,n=r.findIndex(s=>s.id===t);n!==-1&&(r[n]=e.data,this.facturasSubject.next([...r]))}}))}deleteFactura(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(o(()=>{let a=this.facturasSubject.value;this.facturasSubject.next(a.filter(e=>e.id!==t))}))}payFactura(t,a){let e=a?{fecha_pago:a}:{};return this.http.patch(`${this.apiUrl}/${t}/pay`,e).pipe(o(r=>{if(r.data){let n=this.facturasSubject.value,s=n.findIndex(p=>p.id===t);s!==-1&&(n[s]=r.data,this.facturasSubject.next([...n]))}}))}anularFactura(t,a){let e=a?{observaciones:a}:{};return this.http.delete(`${this.apiUrl}/${t}`,{body:e}).pipe(o(r=>{let s=this.facturasSubject.value.filter(p=>p.id!==t);this.facturasSubject.next(s)}))}anularFacturaPatch(t,a){return this.http.patch(`${this.apiUrl}/${t}/anular`,a).pipe(o(e=>{if(e.data){let r=this.facturasSubject.value,n=r.findIndex(s=>s.id===t);n!==-1&&(r[n]=e.data,this.facturasSubject.next([...r]))}}))}getFacturasByLocal(t,a=1,e=10){let r=new c().set("page",a.toString()).set("limit",e.toString()).set("localId",t);return this.http.get(this.apiUrl,{params:r})}createMassiveFacturas(t){return this.http.post(`${this.apiUrl}/massive`,t)}getFacturaStats(t){let a=new c;return t!=null&&t.mercadoId&&(a=a.set("mercadoId",t.mercadoId)),t!=null&&t.localId&&(a=a.set("localId",t.localId)),t!=null&&t.mes&&(a=a.set("mes",t.mes)),t!=null&&t.anio&&(a=a.set("anio",t.anio.toString())),this.http.get(`${this.apiUrl}/stats`,{params:a})}getFacturasVencidas(t=1,a=10){let e=new c().set("page",t.toString()).set("limit",a.toString());return this.http.get(`${this.apiUrl}/vencidas`,{params:e})}getFacturasPendientes(t=1,a=10){let e=new c().set("page",t.toString()).set("limit",a.toString());return this.http.get(`${this.apiUrl}/pendientes`,{params:e})}sendPaymentReminder(t){return this.http.post(`${this.apiUrl}/${t}/reminder`,{})}generateReport(t={},a="pdf"){let e=new c().set("format",a);return t.estado&&(e=e.set("estado",t.estado)),t.localId&&(e=e.set("localId",t.localId)),t.mercadoId&&(e=e.set("mercadoId",t.mercadoId)),t.mes&&(e=e.set("mes",t.mes)),t.anio&&(e=e.set("anio",t.anio.toString())),t.startDate&&(e=e.set("startDate",t.startDate)),t.endDate&&(e=e.set("endDate",t.endDate)),this.http.get(`${this.apiUrl}/report`,{params:e,responseType:"blob"})}exportFacturas(t={}){let a=new c;return t.search&&(a=a.set("search",t.search)),t.estado&&(a=a.set("estado",t.estado)),t.localId&&(a=a.set("localId",t.localId)),t.mercadoId&&(a=a.set("mercadoId",t.mercadoId)),t.mes&&(a=a.set("mes",t.mes)),t.anio&&(a=a.set("anio",t.anio.toString())),this.http.get(`${this.apiUrl}/export`,{params:a,responseType:"blob"})}validateFacturaCreation(t,a,e){let r=new c().set("localId",t).set("mes",a).set("anio",e.toString());return this.http.get(`${this.apiUrl}/validate`,{params:r})}formatMonto(t){if(!t)return"L. 0.00";let a=parseFloat(t.toString());return new Intl.NumberFormat("es-HN",{style:"currency",currency:"HNL",minimumFractionDigits:2}).format(a)}getEstadoColor(t){switch(t==null?void 0:t.toUpperCase()){case"PAGADA":return"success";case"PENDIENTE":return"warning";case"VENCIDA":return"danger";case"ANULADA":return"medium";default:return"primary"}}getEstadoIcon(t){switch(t==null?void 0:t.toUpperCase()){case"PAGADA":return"checkmark-circle-outline";case"PENDIENTE":return"time-outline";case"VENCIDA":return"alert-circle-outline";case"ANULADA":return"close-circle-outline";default:return"document-text-outline"}}formatFecha(t){if(!t)return"N/A";let a=new Date(t);return new Intl.DateTimeFormat("es-HN",{year:"numeric",month:"short",day:"numeric"}).format(a)}getMesNombre(t){return{"01":"Enero","02":"Febrero","03":"Marzo","04":"Abril","05":"Mayo","06":"Junio","07":"Julio","08":"Agosto","09":"Septiembre",10:"Octubre",11:"Noviembre",12:"Diciembre"}[t]||t}};i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=h({token:i,factory:i.\u0275fac,providedIn:"root"});let u=i;return u})();export{j as a};
