import{a as ut}from"./chunk-LQNM3KMO.js";import{a as mt}from"./chunk-ELO4S7WW.js";import{a as st}from"./chunk-5IKKLCCH.js";import{$ as ct,A as it,M as nt,P as at,R as ot,W as rt,Y as lt,b as K,i as Q,j as W,p as X,r as Y,v as Z,y as tt,z as et}from"./chunk-SOBSCE5F.js";import"./chunk-B4FAM7CU.js";import"./chunk-EDQZMFWJ.js";import"./chunk-AL5IVEPX.js";import{$a as J,A as g,B as h,Ba as D,Ca as H,I as C,J as r,Ja as R,K as x,Ka as $,M as A,Pa as q,Q as v,Ra as G,Sa as U,T as d,Y as e,Z as t,Za as z,_,ca as k,da as b,ea as p,i as N,ma as n,na as u,oa as j,va as O,za as E}from"./chunk-WYTV4Y2I.js";import"./chunk-OQQFKM4V.js";import"./chunk-QUJFQN2Y.js";import"./chunk-J7JITKZC.js";import"./chunk-BOXIHRYD.js";import"./chunk-OHGEMRV5.js";import"./chunk-XQESWZ4T.js";import"./chunk-7KGURMOZ.js";import"./chunk-KLXKYU2M.js";import"./chunk-SIK2P2H5.js";import"./chunk-4BNUL4C7.js";import"./chunk-M66VC23L.js";import"./chunk-JMWLUS2D.js";import"./chunk-EUVXMWSF.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-USUO6L27.js";import"./chunk-CKP3SGE2.js";import"./chunk-2LFY4CRM.js";import"./chunk-PJL56ILQ.js";import"./chunk-NVWEJ7GR.js";import"./chunk-UVAVEIEI.js";import"./chunk-E6CW6KXY.js";import"./chunk-Z3EESIK6.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-6WKZVARI.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{h as S}from"./chunk-LNJ3S2LQ.js";var dt=()=>[1,2,3,4,5];function pt(a,m){if(a&1){let l=k();e(0,"ion-buttons",9)(1,"ion-button",10),b("click",function(){g(l);let o=p();return h(o.printInvoice())}),_(2,"ion-icon",11),t(),e(3,"ion-button",10),b("click",function(){g(l);let o=p();return h(o.editFactura())}),_(4,"ion-icon",12),t()()}}function _t(a,m){a&1&&(e(0,"ion-item")(1,"ion-label"),_(2,"ion-skeleton-text",15)(3,"ion-skeleton-text",16),t()()),a&2&&(r(2),d("animated",!0),r(),d("animated",!0))}function ft(a,m){a&1&&(e(0,"div",13)(1,"ion-list"),v(2,_t,4,2,"ion-item",14),t()()),a&2&&(r(2),d("ngForOf",O(1,dt)))}function xt(a,m){if(a&1){let l=k();e(0,"div",17),_(1,"ion-icon",18),e(2,"h2",19),n(3,"Error"),t(),e(4,"p",20),n(5),t(),e(6,"ion-button",21),b("click",function(){g(l);let o=p();return h(o.goBack())}),_(7,"ion-icon",22),n(8," Volver "),t()()}if(a&2){let l=p();r(5),u(l.error())}}function vt(a,m){if(a&1&&(e(0,"ion-item")(1,"ion-label")(2,"h3",24),n(3,"DNI"),t(),e(4,"p",25),n(5),t()()()),a&2){let l,i=p(2);r(5),u((l=i.factura())==null?null:l.propietario_dni)}}function gt(a,m){if(a&1&&(e(0,"ion-item")(1,"ion-label")(2,"h3",24),n(3,"Local"),t(),e(4,"p",25),n(5),t()()()),a&2){let l,i=p(2);r(5),u((l=i.factura())==null?null:l.local_nombre)}}function ht(a,m){if(a&1&&(e(0,"ion-item")(1,"ion-label")(2,"h3",24),n(3,"N\xFAmero de Local"),t(),e(4,"p",25),n(5),t()()()),a&2){let l,i=p(2);r(5),u((l=i.factura())==null?null:l.local_numero)}}function bt(a,m){if(a&1&&(e(0,"ion-item")(1,"ion-label")(2,"h3",24),n(3,"Fecha de Pago"),t(),e(4,"p",25),n(5),E(6,"date"),t()()()),a&2){let l,i=p(2);r(5),u(D(6,1,(l=i.factura())==null?null:l.fecha_pago,"dd/MM/yyyy"))}}function It(a,m){if(a&1&&(e(0,"ion-list",23)(1,"ion-item")(2,"ion-label")(3,"h3",24),n(4,"Observaciones"),t(),e(5,"p",25),n(6),t()()()()),a&2){let l,i=p(2);r(6),u((l=i.factura())==null?null:l.observaciones)}}function St(a,m){if(a&1){let l=k();e(0,"div",13)(1,"ion-list",23)(2,"ion-item")(3,"ion-label")(4,"h3",24),n(5,"N\xFAmero de Factura"),t(),e(6,"p",25),n(7),t()()(),e(8,"ion-item")(9,"ion-label")(10,"h3",24),n(11,"Correlativo"),t(),e(12,"p",25),n(13),t()()(),e(14,"ion-item")(15,"ion-label")(16,"h3",24),n(17,"Concepto"),t(),e(18,"p",25),n(19),t()()(),e(20,"ion-item")(21,"ion-label")(22,"h3",24),n(23,"Propietario"),t(),e(24,"p",25),n(25),t()()(),v(26,vt,6,1,"ion-item",26),t(),e(27,"ion-list",23)(28,"ion-item")(29,"ion-label")(30,"h3",24),n(31,"Mercado"),t(),e(32,"p",25),n(33),t()()(),v(34,gt,6,1,"ion-item",26)(35,ht,6,1,"ion-item",26),t(),e(36,"ion-list",23)(37,"ion-item")(38,"ion-label")(39,"h3",24),n(40,"Monto"),t(),e(41,"p",27),n(42),E(43,"currency"),t()()(),e(44,"ion-item")(45,"ion-label")(46,"h3",24),n(47,"Estado"),t(),e(48,"ion-chip",28),n(49),t()()()(),e(50,"ion-list",23)(51,"ion-item")(52,"ion-label")(53,"h3",24),n(54,"Fecha de Vencimiento"),t(),e(55,"p",25),n(56),E(57,"date"),t()()(),v(58,bt,7,4,"ion-item",26),e(59,"ion-item")(60,"ion-label")(61,"h3",24),n(62,"Fecha de Creaci\xF3n"),t(),e(63,"p",25),n(64),E(65,"date"),t()()()(),v(66,It,7,1,"ion-list",29),e(67,"div",30)(68,"ion-button",31),b("click",function(){g(l);let o=p();return h(o.goBack())}),_(69,"ion-icon",22),n(70," Volver "),t(),e(71,"ion-button",32),b("click",function(){g(l);let o=p();return h(o.printInvoice())}),_(72,"ion-icon",33),n(73," Imprimir "),t(),e(74,"ion-button",34),b("click",function(){g(l);let o=p();return h(o.editFactura())}),_(75,"ion-icon",35),n(76," Editar "),t()()()}if(a&2){let l,i,o,c,f,I,y,F,P,w,T,V,B,L,M,s=p();r(7),u((l=s.factura())==null?null:l.numero_factura),r(6),u((i=s.factura())==null?null:i.correlativo),r(6),u((o=s.factura())==null?null:o.concepto),r(6),u(((c=s.factura())==null?null:c.propietario_nombre)||"No especificado"),r(),d("ngIf",(f=s.factura())==null?null:f.propietario_dni),r(7),u((I=s.factura())==null?null:I.mercado_nombre),r(),d("ngIf",(y=s.factura())==null?null:y.local_nombre),r(),d("ngIf",(F=s.factura())==null?null:F.local_numero),r(7),u(H(43,15,(P=s.factura())==null?null:P.monto,"USD","symbol","1.2-2")),r(6),d("color",((w=s.factura())==null?null:w.estado)==="PAGADA"?"success":((w=s.factura())==null?null:w.estado)==="VENCIDA"?"danger":"warning"),r(),j(" ",(T=s.factura())==null?null:T.estado," "),r(7),u(D(57,20,(V=s.factura())==null?null:V.fecha_vencimiento,"dd/MM/yyyy")),r(2),d("ngIf",(B=s.factura())==null?null:B.fecha_pago),r(6),u(D(65,23,(L=s.factura())==null?null:L.createdAt,"dd/MM/yyyy HH:mm")),r(2),d("ngIf",(M=s.factura())==null?null:M.observaciones)}}var At=(()=>{let m=class m{constructor(i,o,c,f,I,y,F){this.bluetoothService=i,this.printingService=o,this.loadingCtrl=c,this.toastCtrl=f,this.route=I,this.router=y,this.facturasService=F,this.factura=C(null),this.isLoading=C(!0),this.error=C(null)}ngOnInit(){return S(this,null,function*(){let i=this.route.snapshot.paramMap.get("id");if(!i){this.error.set("ID de factura no v\xE1lido"),this.isLoading.set(!1);return}try{let o=yield N(this.facturasService.getFacturaById(i));o.data?this.factura.set(o.data):this.error.set("Factura no encontrada")}catch(o){console.error("Error cargando factura:",o),this.error.set("Error al cargar la factura")}finally{this.isLoading.set(!1)}})}goBack(){this.router.navigate(["/facturas"])}editFactura(){this.factura()&&this.router.navigate(["/facturas/editar",this.factura().id])}printInvoice(){return S(this,null,function*(){let i=this.factura();if(!i){this.showToast("No hay datos de factura para imprimir.");return}let o=yield this.loadingCtrl.create({message:"Imprimiendo..."});yield o.present();try{let c=yield this.bluetoothService.getDefaultPrinter();if(!c)throw new Error("No hay una impresora predeterminada configurada.");this.bluetoothService.connect(c.address).subscribe({next:()=>S(this,null,function*(){let f={id:i.numero_factura,date:i.createdAt,customerName:i.propietario_nombre||"Sin propietario",items:[{quantity:1,description:i.concepto,price:i.monto}],subtotal:i.monto,tax:0,total:i.monto},I=this.printingService.formatInvoiceForPrinting(f);yield this.bluetoothService.print(I),yield this.bluetoothService.disconnect(),this.showToast("Factura impresa correctamente."),o.dismiss()}),error:f=>{o.dismiss(),this.showToast(`Error de conexi\xF3n: ${f.message||"Revise la impresora."}`)}})}catch(c){o.dismiss(),this.showToast(`Error: ${c.message}`)}})}showToast(i){return S(this,null,function*(){(yield this.toastCtrl.create({message:i,duration:3e3,position:"bottom"})).present()})}};m.\u0275fac=function(o){return new(o||m)(x(st),x(mt),x(rt),x(lt),x(z),x(J),x(ut))},m.\u0275cmp=A({type:m,selectors:[["app-factura-detail"]],decls:12,vars:4,consts:[[1,"municipal-toolbar"],["slot","start"],["defaultHref","/facturas"],[1,"text-white","font-semibold"],["slot","end",4,"ngIf"],[1,"bg-gray-50"],[1,"p-4"],["class","space-y-4",4,"ngIf"],["class","text-center py-8",4,"ngIf"],["slot","end"],["fill","clear",3,"click"],["name","print-outline"],["name","create-outline"],[1,"space-y-4"],[4,"ngFor","ngForOf"],[2,"width","60%",3,"animated"],[2,"width","40%",3,"animated"],[1,"text-center","py-8"],["name","alert-circle-outline",1,"text-6xl","text-red-500","mb-4"],[1,"text-xl","font-semibold","text-gray-700","mb-2"],[1,"text-gray-500","mb-4"],["fill","outline",3,"click"],["name","arrow-back-outline","slot","start"],[1,"rounded-lg"],[1,"font-medium"],[1,"text-gray-600"],[4,"ngIf"],[1,"text-2xl","font-bold","text-primary"],[1,"text-xs",3,"color"],["class","rounded-lg",4,"ngIf"],[1,"flex","gap-3","mt-6"],["expand","block","fill","outline","color","medium",1,"flex-1",3,"click"],["expand","block","fill","outline",1,"flex-1",3,"click"],["name","print-outline","slot","start"],["expand","block",1,"flex-1",3,"click"],["name","create-outline","slot","start"]],template:function(o,c){o&1&&(e(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),_(3,"ion-back-button",2),t(),e(4,"ion-title",3),n(5," Detalle de Factura "),t(),v(6,pt,5,0,"ion-buttons",4),t()(),e(7,"ion-content",5)(8,"div",6),v(9,ft,3,2,"div",7)(10,xt,9,1,"div",8)(11,St,77,26,"div",7),t()()),o&2&&(r(6),d("ngIf",c.factura()&&!c.isLoading()),r(3),d("ngIf",c.isLoading()),r(),d("ngIf",!c.isLoading()&&c.error()),r(),d("ngIf",!c.isLoading()&&!c.error()&&c.factura()))},dependencies:[U,R,$,G,q,Y,Z,at,ot,K,Q,ct,W,it,tt,et,nt,X],encapsulation:2});let a=m;return a})();export{At as FacturaDetailPage};
