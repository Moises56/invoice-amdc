import{a as ge}from"./chunk-6ZQI2W4D.js";import"./chunk-WJYYOXGJ.js";import"./chunk-XGVSADFO.js";import{b as ie}from"./chunk-2DHM2XJF.js";import"./chunk-E5CGDO2G.js";import"./chunk-76SUSZ7P.js";import{Ba as de,Ka as ce,La as pe,Xa as ue,a as ae,i as se,ra as le,xa as me}from"./chunk-PIGH2764.js";import"./chunk-HENECHRK.js";import{$ as x,$a as u,Ac as ne,Bc as oe,Cb as B,Fa as y,G as _,Gc as re,H as r,Hb as A,Jb as G,K as I,Kb as D,Lb as j,Mb as V,N as h,Na as F,Nb as H,P as p,Pb as R,Qb as $,R as C,Sb as J,U as a,V as t,Va as S,W as d,Wb as K,Zb as Q,_b as W,aa as w,ab as k,bb as T,db as N,eb as U,fb as L,ia as l,ib as z,ja as v,ka as g,kb as q,mc as X,oc as Y,qc as Z,vc as ee,w as f,xc as te}from"./chunk-5JVX3F6S.js";import"./chunk-3BKI4OCD.js";import"./chunk-QUJFQN2Y.js";import"./chunk-Q54UXUQI.js";import"./chunk-3X2ZBCS4.js";import"./chunk-MIXIO5PR.js";import"./chunk-XQESWZ4T.js";import"./chunk-7KGURMOZ.js";import"./chunk-TLFJBS62.js";import"./chunk-X2MTSPWE.js";import"./chunk-ZXCKTIDB.js";import"./chunk-M66VC23L.js";import"./chunk-L2DIMNML.js";import"./chunk-JEDV2W6G.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-6OKYY42W.js";import"./chunk-CKP3SGE2.js";import"./chunk-Z7MVEU4J.js";import"./chunk-PJL56ILQ.js";import"./chunk-NVWEJ7GR.js";import"./chunk-UVAVEIEI.js";import"./chunk-E6CW6KXY.js";import"./chunk-Z3EESIK6.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-6WKZVARI.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as E,h as b}from"./chunk-LNJ3S2LQ.js";function fe(s,c){if(s&1&&(a(0,"div",35),l(1),t()),s&2){let m=w();r(),g(" ",m.getErrorMessage(m.profileForm,"name")," ")}}function he(s,c){if(s&1&&(a(0,"div",35),l(1),t()),s&2){let m=w();r(),g(" ",m.getErrorMessage(m.profileForm,"email")," ")}}function Pe(s,c){s&1&&d(0,"ion-spinner",36)}function Ce(s,c){s&1&&d(0,"ion-icon",37)}function we(s,c){if(s&1&&(a(0,"div",35),l(1),t()),s&2){let m=w();r(),g(" ",m.getErrorMessage(m.passwordForm,"currentPassword")," ")}}function be(s,c){if(s&1&&(a(0,"div",35),l(1),t()),s&2){let m=w();r(),g(" ",m.getErrorMessage(m.passwordForm,"newPassword")," ")}}function _e(s,c){if(s&1&&(a(0,"div",35),l(1),t()),s&2){let m=w();r(),g(" ",m.getErrorMessage(m.passwordForm,"confirmPassword")," ")}}var Le=(()=>{let c=class c{constructor(){this.formBuilder=f(z),this.authService=f(ie),this.usuariosService=f(ge),this.router=f(S),this.toastController=f(te),this.loadingController=f(ee),this.isLoading=_(!1),this.currentUser=_(null),ae({saveOutline:ue,personOutline:ce,mailOutline:de,phonePortraitOutline:pe,locationOutline:me,keyOutline:le,arrowBackOutline:se}),this.profileForm=this.formBuilder.group({name:["",[u.required,u.minLength(2)]],email:["",[u.required,u.email]],phone:[""],address:[""]}),this.passwordForm=this.formBuilder.group({currentPassword:["",[u.required]],newPassword:["",[u.required,u.minLength(6)]],confirmPassword:["",[u.required]]},{validators:this.passwordMatchValidator})}ngOnInit(){this.loadProfile()}loadProfile(){return b(this,null,function*(){this.isLoading.set(!0);try{let n=this.authService.user();n&&(this.currentUser.set(n),this.profileForm.patchValue({name:n.name,email:n.email,phone:n.phone||"",address:n.address||""}))}catch{yield this.showToast("Error al cargar perfil","danger")}finally{this.isLoading.set(!1)}})}updateProfile(){return b(this,null,function*(){var n;if(this.profileForm.valid){let i=yield this.loadingController.create({message:"Actualizando perfil..."});yield i.present();try{let e=this.currentUser();if(!e)return;let o=this.profileForm.value;yield this.usuariosService.updateUser(e.id,o).toPromise(),yield this.showToast("Perfil actualizado correctamente","success")}catch(e){let o=((n=e==null?void 0:e.error)==null?void 0:n.message)||"Error al actualizar perfil";yield this.showToast(o,"danger")}finally{yield i.dismiss()}}else yield this.showToast("Por favor, complete todos los campos requeridos","warning"),this.markFormGroupTouched(this.profileForm)})}changePassword(){return b(this,null,function*(){var n;if(this.passwordForm.valid){let i=yield this.loadingController.create({message:"Cambiando contrase\xF1a..."});yield i.present();try{let e=this.currentUser();if(!e)return;let{newPassword:o}=this.passwordForm.value;yield this.usuariosService.changePassword(e.id,o).toPromise(),this.passwordForm.reset(),yield this.showToast("Contrase\xF1a cambiada correctamente","success")}catch(e){let o=((n=e==null?void 0:e.error)==null?void 0:n.message)||"Error al cambiar contrase\xF1a";yield this.showToast(o,"danger")}finally{yield i.dismiss()}}else yield this.showToast("Por favor, complete todos los campos requeridos","warning"),this.markFormGroupTouched(this.passwordForm)})}passwordMatchValidator(n){var o;let i=n.get("newPassword"),e=n.get("confirmPassword");if(i!=null&&i.value&&(e!=null&&e.value)&&i.value!==e.value)return e==null||e.setErrors({passwordMismatch:!0}),{passwordMismatch:!0};if((o=e==null?void 0:e.errors)!=null&&o.passwordMismatch){let P=E({},e.errors);delete P.passwordMismatch,e.setErrors(Object.keys(P).length?P:null)}return null}markFormGroupTouched(n){Object.keys(n.controls).forEach(i=>{let e=n.get(i);e==null||e.markAsTouched()})}hasError(n,i,e){let o=n.get(i);return o?e?o.hasError(e)&&o.touched:o.invalid&&o.touched:!1}getErrorMessage(n,i){let e=n.get(i);if(!e||!e.errors||!e.touched)return"";let o=e.errors;return o.required?"Este campo es requerido":o.email?"Ingrese un email v\xE1lido":o.minlength?`M\xEDnimo ${o.minlength.requiredLength} caracteres`:o.passwordMismatch?"Las contrase\xF1as no coinciden":"Campo inv\xE1lido"}goBack(){this.router.navigate(["/dashboard"])}showToast(n,i){return b(this,null,function*(){yield(yield this.toastController.create({message:n,duration:3e3,color:i,position:"top"})).present()})}getInitials(n){return n.split(" ").map(i=>i[0]).join("").toUpperCase().substring(0,2)}};c.\u0275fac=function(i){return new(i||c)},c.\u0275cmp=I({type:c,selectors:[["app-profile"]],decls:74,vars:26,consts:[[1,"municipal-toolbar"],["slot","start"],["defaultHref","/dashboard"],[1,"text-white","font-semibold"],[1,"bg-gray-50"],[1,"p-4"],[1,"text-center","mb-6"],[1,"w-24","h-24","mx-auto","mb-4"],[1,"w-full","h-full","bg-primary","rounded-full","flex","items-center","justify-center"],[1,"text-white","text-2xl","font-bold"],[1,"text-xl","font-semibold","text-gray-800","mb-1"],[1,"text-sm","text-gray-500","mb-2"],["outline","",3,"color"],[1,"shadow-sm","mb-4"],[1,"pb-2"],[1,"text-lg","text-gray-800","flex","items-center"],["name","person-outline",1,"mr-2","text-primary"],[1,"pt-0"],[3,"ngSubmit","formGroup"],["lines","none",1,"mb-3","rounded-lg","custom-input"],["position","stacked",1,"text-sm","font-medium","text-gray-700"],["formControlName","name","placeholder","Ingrese su nombre completo",1,"mt-1"],["class","error-message",4,"ngIf"],["formControlName","email","type","email","placeholder","su-email@ejemplo.com",1,"mt-1"],["formControlName","phone","type","tel","placeholder","N\xFAmero de tel\xE9fono",1,"mt-1"],["formControlName","address","placeholder","Direcci\xF3n completa","rows","3",1,"mt-1"],["expand","block","type","submit",1,"mt-4",3,"disabled"],["name","crescent","slot","start",4,"ngIf"],["name","save-outline","slot","start",4,"ngIf"],["name","key-outline",1,"mr-2","text-primary"],["formControlName","currentPassword","type","password","placeholder","Ingrese su contrase\xF1a actual",1,"mt-1"],["formControlName","newPassword","type","password","placeholder","Ingrese la nueva contrase\xF1a",1,"mt-1"],["formControlName","confirmPassword","type","password","placeholder","Confirme la nueva contrase\xF1a",1,"mt-1"],["expand","block","type","submit","fill","outline","color","primary",1,"mt-4",3,"disabled"],["name","key-outline","slot","start"],[1,"error-message"],["name","crescent","slot","start"],["name","save-outline","slot","start"]],template:function(i,e){if(i&1&&(a(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),d(3,"ion-back-button",2),t(),a(4,"ion-title",3),l(5,"Mi Perfil"),t()()(),a(6,"ion-content",4)(7,"div",5)(8,"div",6)(9,"ion-avatar",7)(10,"div",8)(11,"span",9),l(12),t()()(),a(13,"h2",10),l(14),t(),a(15,"p",11),l(16),t(),a(17,"ion-chip",12)(18,"ion-label"),l(19),t()()(),a(20,"ion-card",13)(21,"ion-card-header",14)(22,"ion-card-title",15),d(23,"ion-icon",16),l(24," Informaci\xF3n Personal "),t()(),a(25,"ion-card-content",17)(26,"form",18),x("ngSubmit",function(){return e.updateProfile()}),a(27,"ion-item",19)(28,"ion-label",20),l(29," Nombre Completo * "),t(),d(30,"ion-input",21),t(),h(31,fe,2,1,"div",22),a(32,"ion-item",19)(33,"ion-label",20),l(34," Correo Electr\xF3nico * "),t(),d(35,"ion-input",23),t(),h(36,he,2,1,"div",22),a(37,"ion-item",19)(38,"ion-label",20),l(39," Tel\xE9fono "),t(),d(40,"ion-input",24),t(),a(41,"ion-item",19)(42,"ion-label",20),l(43," Direcci\xF3n "),t(),d(44,"ion-textarea",25),t(),a(45,"ion-button",26),h(46,Pe,1,0,"ion-spinner",27)(47,Ce,1,0,"ion-icon",28),l(48," Actualizar Perfil "),t()()()(),a(49,"ion-card",13)(50,"ion-card-header",14)(51,"ion-card-title",15),d(52,"ion-icon",29),l(53," Cambiar Contrase\xF1a "),t()(),a(54,"ion-card-content",17)(55,"form",18),x("ngSubmit",function(){return e.changePassword()}),a(56,"ion-item",19)(57,"ion-label",20),l(58," Contrase\xF1a Actual * "),t(),d(59,"ion-input",30),t(),h(60,we,2,1,"div",22),a(61,"ion-item",19)(62,"ion-label",20),l(63," Nueva Contrase\xF1a * "),t(),d(64,"ion-input",31),t(),h(65,be,2,1,"div",22),a(66,"ion-item",19)(67,"ion-label",20),l(68," Confirmar Nueva Contrase\xF1a * "),t(),d(69,"ion-input",32),t(),h(70,_e,2,1,"div",22),a(71,"ion-button",33),d(72,"ion-icon",34),l(73," Cambiar Contrase\xF1a "),t()()()()()()),i&2){let o,P,M,O;r(12),g(" ",e.currentUser()?e.getInitials(e.currentUser().name||e.currentUser().nombre||"U"):"U"," "),r(2),g(" ",(o=e.currentUser())==null?null:o.name," "),r(2),v((P=e.currentUser())==null?null:P.email),r(),p("color",((M=e.currentUser())==null?null:M.role)==="ADMIN"?"danger":"primary"),r(2),v((O=e.currentUser())==null?null:O.role),r(7),p("formGroup",e.profileForm),r(4),C("is-invalid",e.hasError(e.profileForm,"name")),r(),p("ngIf",e.hasError(e.profileForm,"name")),r(4),C("is-invalid",e.hasError(e.profileForm,"email")),r(),p("ngIf",e.hasError(e.profileForm,"email")),r(9),p("disabled",e.profileForm.invalid||e.isLoading()),r(),p("ngIf",e.isLoading()),r(),p("ngIf",!e.isLoading()),r(8),p("formGroup",e.passwordForm),r(4),C("is-invalid",e.hasError(e.passwordForm,"currentPassword")),r(),p("ngIf",e.hasError(e.passwordForm,"currentPassword")),r(4),C("is-invalid",e.hasError(e.passwordForm,"newPassword")),r(),p("ngIf",e.hasError(e.passwordForm,"newPassword")),r(4),C("is-invalid",e.hasError(e.passwordForm,"confirmPassword")),r(),p("ngIf",e.hasError(e.passwordForm,"confirmPassword")),r(),p("disabled",e.passwordForm.invalid)}},dependencies:[F,y,q,N,k,T,U,L,J,K,Y,Z,D,G,ne,j,H,R,V,Q,W,oe,re,A,$,B,X],styles:["ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #3880ff;--color: white}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{font-weight:600}ion-content[_ngcontent-%COMP%]{--background: #f5f5f5}.profile-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;padding:16px}.profile-header[_ngcontent-%COMP%]{text-align:center;padding:24px 16px;background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000001a}.profile-header[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:100px;height:100px;margin:0 auto 16px;border:4px solid #3880ff;box-shadow:0 4px 12px #00000026}.profile-header[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#1a1a1a;margin-bottom:8px}.profile-header[_ngcontent-%COMP%]   .user-email[_ngcontent-%COMP%]{color:#666;font-size:1rem}.profile-header[_ngcontent-%COMP%]   .user-role[_ngcontent-%COMP%]{margin-top:12px}.profile-section[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000001a;overflow:hidden}.profile-section[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]{padding:16px;background:#f8f9fa;border-bottom:1px solid #e9ecef}.profile-section[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;font-weight:600;color:#1a1a1a}.profile-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--border-color: #e9ecef;--padding-start: 16px;--padding-end: 16px}.profile-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#3880ff;margin-right:12px}.profile-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#1a1a1a;margin-bottom:4px}.profile-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:#666;margin:0}.action-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-top:24px}.action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-weight:500}.action-buttons[_ngcontent-%COMP%]   ion-button.edit-button[_ngcontent-%COMP%]{--background: #3880ff;--color: white}.action-buttons[_ngcontent-%COMP%]   ion-button.change-password-button[_ngcontent-%COMP%]{--background: #28a745;--color: white}.action-buttons[_ngcontent-%COMP%]   ion-button.logout-button[_ngcontent-%COMP%]{--background: #dc3545;--color: white}.password-form[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000001a;padding:20px;margin-top:16px}.password-form[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:24px}.password-form[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.2rem;font-weight:600;color:#1a1a1a}.password-form[_ngcontent-%COMP%]   .form-buttons[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:20px}.password-form[_ngcontent-%COMP%]   .form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex:1;--border-radius: 8px;height:44px;font-weight:500}.password-form[_ngcontent-%COMP%]   .form-buttons[_ngcontent-%COMP%]   ion-button.save-button[_ngcontent-%COMP%]{--background: #28a745;--color: white}.password-form[_ngcontent-%COMP%]   .form-buttons[_ngcontent-%COMP%]   ion-button.cancel-button[_ngcontent-%COMP%]{--background: #6c757d;--color: white}.error-message[_ngcontent-%COMP%]{color:#dc3545;font-size:.85rem;margin-top:4px;margin-left:16px}@media (min-width: 768px){.profile-container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto}.action-buttons[_ngcontent-%COMP%]{flex-direction:row}.action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex:1}}"]});let s=c;return s})();export{Le as ProfilePage};
