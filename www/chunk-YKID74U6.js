import{a as h}from"./chunk-XGVSADFO.js";import{a as i}from"./chunk-76SUSZ7P.js";import{Qa as b,c as l,s as o,u as d,w as U}from"./chunk-2VKWM52Q.js";import{a as p}from"./chunk-RW4GY4BD.js";var w=(()=>{let n=class n{constructor(){this.http=U(b),this.baseUrl=`${h.BASE_URL}/users`,this.usuariosSubject=new l([]),this.usuarios$=this.usuariosSubject.asObservable()}getUsers(t=1,e=10,s){let a=new URLSearchParams(p({page:t.toString(),limit:e.toString()},s));return this.http.get(`${this.baseUrl}?${a}`).pipe(o(r=>{t===1&&this.usuariosSubject.next(r.data)}))}getUserById(t){return this.http.get(`${this.baseUrl}/${t}`)}createUser(t){return this.http.post(this.baseUrl,t).pipe(o(e=>{let s=this.usuariosSubject.value;this.usuariosSubject.next([...s,e])}))}updateUser(t,e){return this.http.put(`${this.baseUrl}/${t}`,e).pipe(o(s=>{let a=this.usuariosSubject.value,r=a.findIndex(u=>u.id===t);r!==-1&&(a[r]=s,this.usuariosSubject.next([...a]))}))}deleteUser(t){return this.http.delete(`${this.baseUrl}/${t}`).pipe(o(()=>{let e=this.usuariosSubject.value;this.usuariosSubject.next(e.filter(s=>s.id!==t))}))}activateUser(t){return this.http.patch(`${this.baseUrl}/${t}/activate`,{}).pipe(o(e=>{let s=this.usuariosSubject.value,a=s.findIndex(r=>r.id===t);a!==-1&&(s[a]=e,this.usuariosSubject.next([...s]))}))}toggleUserStatus(t,e){let s=e?"activate":"deactivate";return this.http.patch(`${this.baseUrl}/${t}/${s}`,{}).pipe(o(a=>{let r=this.usuariosSubject.value,u=r.findIndex(f=>f.id===t);u!==-1&&(r[u]=a,this.usuariosSubject.next([...r]))}))}changePassword(t,e){return this.http.post(`${h.BASE_URL}/auth/change-password`,{currentPassword:t,newPassword:e})}changeUserPassword(t,e){return this.http.patch(`${this.baseUrl}/${t}/reset-password`,{newPassword:e})}getAvailableRoles(){return Object.values(i)}resetPassword(t){return this.http.post(`${this.baseUrl}/${t}/reset-password`,{})}searchUsers(t){return this.http.get(`${this.baseUrl}/search?q=${encodeURIComponent(t)}`)}getUserStats(){return this.http.get(`${this.baseUrl}/stats`)}getAvatarInitials(t){var a,r,u;let e=((a=t.nombre)==null?void 0:a.charAt(0))||"",s=((r=t.apellido)==null?void 0:r.charAt(0))||"";return(e+s).toUpperCase()||((u=t.username)==null?void 0:u.charAt(0).toUpperCase())||"U"}getRoleColor(t){switch(t){case i.ADMIN:return"danger";case i.MARKET:return"warning";case i.USER:return"primary";default:return"medium"}}getRoleText(t){switch(t){case i.ADMIN:return"Administrador";case i.MARKET:return"Gerente de Mercado";case i.USER:return"Usuario";default:return t}}getFullName(t){return`${t.nombre||""} ${t.apellido||""}`.trim()||t.username}formatLastLogin(t){if(!t)return"Nunca";let e=new Date,s=new Date(t),a=e.getTime()-s.getTime(),r=Math.floor(a/(1e3*60*60*24));return r===0?"Hoy":r===1?"Ayer":r<7?`Hace ${r} d\xEDas`:s.toLocaleDateString("es-ES")}getUserStatus(t){return t.isActive?{text:"Activo",color:"success"}:{text:"Inactivo",color:"danger"}}updateUserStatus(t,e){return this.http.patch(`${this.baseUrl}/${t}/status`,{isActive:e})}};n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=d({token:n,factory:n.\u0275fac,providedIn:"root"});let c=n;return c})();export{w as a};
