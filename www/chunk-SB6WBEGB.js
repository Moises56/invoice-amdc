import{a as ae}from"./chunk-CKIJNXSO.js";import{a as re}from"./chunk-ONCFXWBN.js";import{Xa as oe,a as ie,xa as ne}from"./chunk-PIGH2764.js";import{$ as Z,N as Q,P as W,Q as X,R as Y,aa as ee,b as j,fa as te,i as z,j as A,k as V,l as $,m as D,o as H,r as R,v as U,y as J,z as K}from"./chunk-SOBSCE5F.js";import"./chunk-AL5IVEPX.js";import{$a as O,I as g,J as n,Ka as y,M as F,Pb as m,Q as f,Qb as k,Rb as L,Sa as P,T as s,Tb as w,Ub as N,V as _,Vb as q,Y as a,Yb as G,Z as i,Za as T,_ as c,_b as B,da as I,ea as b,ma as d,na as S,oa as h,x as p}from"./chunk-WYTV4Y2I.js";import"./chunk-XQESWZ4T.js";import"./chunk-7KGURMOZ.js";import"./chunk-PJL56ILQ.js";import"./chunk-NVWEJ7GR.js";import"./chunk-UVAVEIEI.js";import"./chunk-E6CW6KXY.js";import"./chunk-Z3EESIK6.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-6WKZVARI.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{h as C}from"./chunk-LNJ3S2LQ.js";function de(r,l){if(r&1&&(a(0,"div",25),d(1),i()),r&2){let u=b();n(),h(" ",u.getFieldError("nombre_mercado")," ")}}function se(r,l){if(r&1&&(a(0,"div",25),d(1),i()),r&2){let u=b();n(),h(" ",u.getFieldError("direccion")," ")}}function le(r,l){if(r&1&&(a(0,"div",25),d(1),i()),r&2){let u=b();n(),h(" ",u.getFieldError("latitud")," ")}}function me(r,l){if(r&1&&(a(0,"div",25),d(1),i()),r&2){let u=b();n(),h(" ",u.getFieldError("longitud")," ")}}function ce(r,l){r&1&&c(0,"ion-spinner",26)}function ue(r,l){r&1&&c(0,"ion-icon",27)}var Se=(()=>{let l=class l{constructor(){this.mercadosService=p(re),this.fb=p(G),this.route=p(T),this.eventService=p(ae),this.router=p(O),this.mercado=g(null),this.isLoading=g(!1),this.isEditing=g(!1),this.toastMessage=g(""),this.isToastOpen=g(!1),ie({locationOutline:ne,saveOutline:oe}),this.initializeForm()}ngOnInit(){let o=this.route.snapshot.paramMap.get("id");o&&(this.isEditing.set(!0),this.loadMercado(o))}initializeForm(){this.form=this.fb.group({nombre_mercado:["",[m.required,m.minLength(3)]],direccion:["",[m.required,m.minLength(10)]],latitud:["",[m.required,m.min(-90),m.max(90)]],longitud:["",[m.required,m.min(-180),m.max(180)]],descripcion:[""]})}loadMercado(o){this.isLoading.set(!0),this.mercadosService.getMarketById(o).subscribe({next:e=>{e&&e.id?(this.mercado.set(e),this.form.patchValue({nombre_mercado:e.nombre_mercado||"",direccion:e.direccion||"",latitud:e.latitud||0,longitud:e.longitud||0,descripcion:e.descripcion||""}),this.form.markAsPristine(),this.form.markAsUntouched()):this.showToast("No se pudo cargar la informaci\xF3n del mercado"),this.isLoading.set(!1)},error:e=>{this.showToast("Error al cargar el mercado"),this.isLoading.set(!1)}})}onSubmit(){return C(this,null,function*(){if(this.form.valid)try{if(this.isLoading.set(!0),this.isEditing()){let o=this.form.value,e=yield this.mercadosService.updateMarket(this.mercado().id,o).toPromise();this.showToast("Mercado actualizado exitosamente"),this.eventService.emit("mercado:updated",e==null?void 0:e.data)}else{let o=this.form.value,e=yield this.mercadosService.createMarket(o).toPromise();this.showToast("Mercado creado exitosamente"),this.eventService.emit("mercado:created",e==null?void 0:e.data)}setTimeout(()=>{this.router.navigate(["/mercados"])},1e3)}catch{this.showToast("Error al guardar el mercado")}finally{this.isLoading.set(!1)}else this.markFormGroupTouched()})}markFormGroupTouched(){Object.keys(this.form.controls).forEach(o=>{let e=this.form.get(o);e==null||e.markAsTouched()})}showToast(o){this.toastMessage.set(o),this.isToastOpen.set(!0)}getFieldError(o){let e=this.form.get(o);if(e!=null&&e.errors&&e.touched){if(e.errors.required)return`${o} es requerido`;if(e.errors.minlength)return`${o} debe tener al menos ${e.errors.minlength.requiredLength} caracteres`;if(e.errors.min)return`Valor m\xEDnimo: ${e.errors.min.min}`;if(e.errors.max)return`Valor m\xE1ximo: ${e.errors.max.max}`}return""}isFieldInvalid(o){let e=this.form.get(o);return!!(e!=null&&e.invalid&&e.touched)}};l.\u0275fac=function(e){return new(e||l)},l.\u0275cmp=F({type:l,selectors:[["app-mercado-form"]],decls:49,vars:32,consts:[[2,"background","#5ccedf"],[2,"background","#5ccedf","min-height","env(safe-area-inset-top, 24px) + 56px","padding-top","env(safe-area-inset-top, 24px)"],["slot","start"],["defaultHref","/mercados"],[2,"color","#fff","font-weight","bold"],[3,"fullscreen"],[1,"container","mx-auto","p-4"],[3,"ngSubmit","formGroup"],[1,"mb-4"],["position","stacked"],["formControlName","nombre_mercado","placeholder","Ingrese el nombre del mercado"],["class","error-message",4,"ngIf"],["formControlName","direccion","placeholder","Ingrese la direcci\xF3n completa",3,"rows"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4"],["formControlName","latitud","type","number","step","any","placeholder","-12.0464"],["name","location-outline","slot","end"],["formControlName","longitud","type","number","step","any","placeholder","-77.0428"],[1,"mb-6"],["formControlName","descripcion","placeholder","Descripci\xF3n adicional del mercado (opcional)",3,"rows"],[1,"flex","justify-end","space-x-4"],["fill","clear","color","medium",3,"click"],["type","submit","color","primary",3,"disabled"],["name","crescent","class","mr-2",4,"ngIf"],["name","save-outline","slot","start",4,"ngIf"],["color","success","position","top",3,"didDismiss","isOpen","message","duration"],[1,"error-message"],["name","crescent",1,"mr-2"],["name","save-outline","slot","start"]],template:function(e,t){if(e&1&&(a(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),c(3,"ion-back-button",3),i(),a(4,"ion-title",4),d(5),i()()(),a(6,"ion-content",5)(7,"div",6)(8,"ion-card")(9,"ion-card-header")(10,"ion-card-title"),d(11,"Informaci\xF3n del Mercado"),i()(),a(12,"ion-card-content")(13,"form",7),I("ngSubmit",function(){return t.onSubmit()}),a(14,"ion-item",8)(15,"ion-label",9),d(16,"Nombre del Mercado *"),i(),c(17,"ion-input",10),f(18,de,2,1,"div",11),i(),a(19,"ion-item",8)(20,"ion-label",9),d(21,"Direcci\xF3n *"),i(),c(22,"ion-textarea",12),f(23,se,2,1,"div",11),i(),a(24,"div",13)(25,"ion-item")(26,"ion-label",9),d(27,"Latitud *"),i(),a(28,"ion-input",14),c(29,"ion-icon",15),i(),f(30,le,2,1,"div",11),i(),a(31,"ion-item")(32,"ion-label",9),d(33,"Longitud *"),i(),a(34,"ion-input",16),c(35,"ion-icon",15),i(),f(36,me,2,1,"div",11),i()(),a(37,"ion-item",17)(38,"ion-label",9),d(39,"Descripci\xF3n"),i(),c(40,"ion-textarea",18),i(),a(41,"div",19)(42,"ion-button",20),I("click",function(){return t.router.navigate(["/mercados"])}),d(43," Cancelar "),i(),a(44,"ion-button",21),f(45,ce,1,0,"ion-spinner",22)(46,ue,1,0,"ion-icon",23),d(47),i()()()()()(),a(48,"ion-toast",24),I("didDismiss",function(){return t.isToastOpen.set(!1)}),i()()),e&2){let v,M,E,x;n(5),S(t.isEditing()?"Editar Mercado":"Nuevo Mercado"),n(),s("fullscreen",!0),n(7),s("formGroup",t.form),n(4),_("ion-invalid",t.isFieldInvalid("nombre_mercado"))("ion-touched",(v=t.form.get("nombre_mercado"))==null?null:v.touched),n(),s("ngIf",t.getFieldError("nombre_mercado")),n(4),_("ion-invalid",t.isFieldInvalid("direccion"))("ion-touched",(M=t.form.get("direccion"))==null?null:M.touched),s("rows",3),n(),s("ngIf",t.getFieldError("direccion")),n(5),_("ion-invalid",t.isFieldInvalid("latitud"))("ion-touched",(E=t.form.get("latitud"))==null?null:E.touched),n(2),s("ngIf",t.getFieldError("latitud")),n(4),_("ion-invalid",t.isFieldInvalid("longitud"))("ion-touched",(x=t.form.get("longitud"))==null?null:x.touched),n(2),s("ngIf",t.getFieldError("longitud")),n(4),s("rows",4),n(4),s("disabled",!t.form.valid||t.isLoading()),n(),s("ngIf",t.isLoading()),n(),s("ngIf",!t.isLoading()),n(),h(" ",t.isLoading()?"Guardando...":t.isEditing()?"Actualizar":"Crear"," "),n(),s("isOpen",t.isToastOpen())("message",t.toastMessage())("duration",3e3)}},dependencies:[P,y,B,w,k,L,N,q,R,U,W,Y,j,A,V,D,H,$,J,K,ee,te,z,Q,X,Z],styles:[".error-message[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-size:.875rem;margin-top:.25rem;display:block}.grid[_ngcontent-%COMP%]{display:grid}.grid-cols-1[_ngcontent-%COMP%]{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}.gap-4[_ngcontent-%COMP%]{gap:1rem}.mb-4[_ngcontent-%COMP%]{margin-bottom:1rem}.mb-6[_ngcontent-%COMP%]{margin-bottom:1.5rem}.mr-2[_ngcontent-%COMP%]{margin-right:.5rem}.flex[_ngcontent-%COMP%]{display:flex}.justify-end[_ngcontent-%COMP%]{justify-content:flex-end}.space-x-4[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-left:1rem}@media (min-width: 768px){.md\\\\[_ngcontent-%COMP%]:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}}"]});let r=l;return r})();export{Se as MercadoFormPage};
