import{a as Ze,b as et}from"./chunk-JKPOXX6X.js";import{b as M}from"./chunk-2DHM2XJF.js";import"./chunk-E5CGDO2G.js";import{a as l}from"./chunk-76SUSZ7P.js";import{$a as Xe,Aa as Ge,Ha as Je,Ka as Ne,Sa as Qe,a as Ve,fb as Ye,h as qe,na as ze,s as We,v as Be}from"./chunk-PIGH2764.js";import"./chunk-HENECHRK.js";import{$ as N,$b as Le,Ac as Ke,Bb as ke,Ea as be,Fa as ve,Gb as Ee,H as P,K as ge,N as J,Na as we,Oa as ye,P as U,Ra as Ce,Sa as _e,Sb as Ie,U as p,Ua as Ae,V as v,Va as R,W as T,Wa as xe,Wb as Se,Xa as Pe,Ya as Oe,Zb as Te,_ as ne,_b as Re,a as le,aa as O,ac as Ue,c as ue,cc as je,h as ee,ia as E,j as de,ja as Q,l as W,m as me,n as te,o as he,oc as $e,p as fe,qc as De,r as pe,sc as Fe,u as B,w as g,wc as He,y as z,z as G,zb as Me}from"./chunk-5JVX3F6S.js";import"./chunk-3BKI4OCD.js";import"./chunk-QUJFQN2Y.js";import"./chunk-Q54UXUQI.js";import"./chunk-3X2ZBCS4.js";import"./chunk-MIXIO5PR.js";import"./chunk-XQESWZ4T.js";import"./chunk-7KGURMOZ.js";import"./chunk-TLFJBS62.js";import"./chunk-X2MTSPWE.js";import"./chunk-ZXCKTIDB.js";import"./chunk-M66VC23L.js";import"./chunk-L2DIMNML.js";import"./chunk-JEDV2W6G.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-6OKYY42W.js";import"./chunk-CKP3SGE2.js";import"./chunk-Z7MVEU4J.js";import"./chunk-PJL56ILQ.js";import"./chunk-NVWEJ7GR.js";import"./chunk-UVAVEIEI.js";import"./chunk-E6CW6KXY.js";import"./chunk-Z3EESIK6.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-6WKZVARI.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as ce,h as c}from"./chunk-LNJ3S2LQ.js";var y=(()=>{let e=class e{constructor(){this.authService=g(M),this.router=g(R),this.AUTH_CHECK_TIMEOUT=5e3}canActivate(){return this.checkAuth()}checkAuth(){return c(this,null,function*(){console.log("\u{1F6E1}\uFE0F AuthGuard: Verificando autenticaci\xF3n...");let r=0,o=50;for(;!this.authService.authCheckComplete()&&r<o;)yield new Promise(i=>setTimeout(i,100)),r++;if(r>=o)return console.log("\u26A0\uFE0F AuthGuard: Timeout en verificaci\xF3n inicial, usando fallback"),yield this.checkAuthWithFallback();if(this.authService.isAuthenticated())return console.log("\u2705 Usuario autenticado, permitiendo acceso"),!0;try{if(yield this.checkAuthWithTimeout())return console.log("\u2705 Usuario autenticado despu\xE9s de verificaci\xF3n con timeout"),!0}catch(i){console.log("\u274C Error en verificaci\xF3n de autenticaci\xF3n con timeout:",i)}return console.log("\u{1F6AB} Usuario no autenticado, redirigiendo al login"),this.router.createUrlTree(["/login"])})}checkAuthWithTimeout(){return new Promise((r,o)=>{let i=W(this.AUTH_CHECK_TIMEOUT),s=this.authService.checkAuthStatus();me(s,i.pipe(de(()=>{throw new Error("Timeout")}))).subscribe({next:a=>r(a),error:a=>{a.message==="Timeout"?(console.log("\u23F0 Timeout en verificaci\xF3n de autenticaci\xF3n"),r(!1)):o(a)}})})}checkAuthWithFallback(){return c(this,null,function*(){try{if(yield this.authService.checkAuthStatus())return console.log("\u2705 Usuario autenticado en fallback"),!0}catch(r){console.log("\u274C Error en fallback de verificaci\xF3n:",r)}return console.log("\u{1F6AB} Fallback: Usuario no autenticado"),this.router.createUrlTree(["/login"])})}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=B({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var L=(()=>{let e=class e{constructor(){this.authService=g(M),this.router=g(R)}canActivate(r){let o=r.data.roles;return this.authService.isAuthenticated()?!o||o.length===0||this.authService.hasAnyRole(o)?!0:this.router.createUrlTree(["/dashboard"]):this.router.createUrlTree(["/login"])}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=B({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var nt=[{path:"",redirectTo:"/dashboard",pathMatch:"full"},{path:"login",loadComponent:()=>import("./chunk-X43F4YQJ.js").then(t=>t.LoginPage)},{path:"dashboard",loadComponent:()=>import("./chunk-DT7QVY3Q.js").then(t=>t.DashboardPage),canActivate:[y]},{path:"reportes",loadComponent:()=>import("./chunk-JHFYSMVR.js").then(t=>t.ReportesPage),canActivate:[y]},{path:"usuarios",loadChildren:()=>import("./chunk-BLQEE65E.js").then(t=>t.routes),canActivate:[y,L],data:{roles:[l.ADMIN]}},{path:"mercados",loadChildren:()=>import("./chunk-JTJPIVVT.js").then(t=>t.routes),canActivate:[y,L],data:{roles:[l.ADMIN,l.MARKET]}},{path:"locales",loadChildren:()=>import("./chunk-GVONOTZE.js").then(t=>t.routes),canActivate:[y,L],data:{roles:[l.ADMIN,l.MARKET,l.USER]}},{path:"facturas",loadChildren:()=>import("./chunk-4MHW4BND.js").then(t=>t.routes),canActivate:[y,L],data:{roles:[l.ADMIN,l.MARKET,l.USER]}},{path:"auditoria",loadChildren:()=>import("./chunk-ETJFIWYT.js").then(t=>t.routes),canActivate:[y,L],data:{roles:[l.ADMIN]}},{path:"bluetooth",loadChildren:()=>import("./chunk-XJDQ72D2.js").then(t=>t.routes),canActivate:[y]},{path:"perfil",loadComponent:()=>import("./chunk-AEG7E5NY.js").then(t=>t.ProfilePage),canActivate:[y]},{path:"**",redirectTo:"/dashboard"}];function dt(t,e){if(t&1){let n=ne();p(0,"ion-item",18),N("click",function(){z(n);let o=O().$implicit,i=O(2);return G(i.navigateTo(o.url))}),T(1,"ion-icon",23),p(2,"ion-label",17),E(3),v()()}if(t&2){let n=O().$implicit;P(),U("name",n.icon),P(2),Q(n.title)}}function mt(t,e){if(t&1&&(p(0,"ion-menu-toggle",21),J(1,dt,4,2,"ion-item",22),v()),t&2){let n=e.$implicit,r=O(2);P(),U("ngIf",r.hasAccess(n))}}function ht(t,e){if(t&1){let n=ne();p(0,"ion-menu",2)(1,"ion-header")(2,"ion-toolbar",3)(3,"ion-title",4),E(4," AMDC "),v()()(),p(5,"ion-content")(6,"div",5)(7,"div",6)(8,"div",7),T(9,"ion-icon",8),v(),p(10,"div",9)(11,"h3",10),E(12),v(),p(13,"p",11),E(14),v()()()(),p(15,"ion-list",12),J(16,mt,2,1,"ion-menu-toggle",13),v(),p(17,"div",14)(18,"ion-item",15),N("click",function(){z(n);let o=O();return G(o.goToProfile())}),T(19,"ion-icon",16),p(20,"ion-label",17),E(21,"Mi Perfil"),v()(),p(22,"ion-item",18),N("click",function(){z(n);let o=O();return G(o.logout())}),T(23,"ion-icon",19),p(24,"ion-label",20),E(25,"Cerrar Sesi\xF3n"),v()()()()()}if(t&2){let n=O();P(12),Q(n.userName()),P(2),Q(n.userRole()),P(2),U("ngForOf",n.menuItems)}}var rt=(()=>{let e=class e{constructor(){this.authService=g(M),this.router=g(R),this.menuController=g(He),this.user=this.authService.user,this.isAuthenticated=this.authService.isAuthenticated,this.userRole=this.authService.userRole,this.userName=this.authService.userName,this.menuItems=[{title:"Dashboard",url:"/dashboard",icon:"home-outline"},{title:"Usuarios",url:"/usuarios",icon:"people-outline",roles:[l.ADMIN]},{title:"Mercados",url:"/mercados",icon:"business-outline",roles:[l.ADMIN,l.MARKET]},{title:"Locales",url:"/locales",icon:"storefront-outline",roles:[l.ADMIN,l.MARKET,l.USER]},{title:"Facturas",url:"/facturas",icon:"receipt-outline",roles:[l.ADMIN,l.MARKET,l.USER]},{title:"Auditor\xEDa",url:"/auditoria",icon:"analytics-outline",roles:[l.ADMIN]},{title:"Bluetooth",url:"/bluetooth",icon:"bluetooth-outline"}],Ve({homeOutline:ze,businessOutline:Be,storefrontOutline:Ye,receiptOutline:Qe,peopleOutline:Je,analyticsOutline:qe,bluetoothOutline:We,personOutline:Ne,logOutOutline:Ge,settingsOutline:Xe})}ngOnInit(){!this.isAuthenticated()&&this.router.url!=="/login"&&this.router.navigate(["/login"])}hasAccess(r){return!r.roles||r.roles.length===0?!0:this.authService.hasAnyRole(r.roles)}navigateTo(r){this.router.navigate([r]),this.menuController.close()}goToProfile(){this.router.navigate(["/perfil"]),this.menuController.close()}logout(){this.authService.logout().subscribe(),this.menuController.close()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=ge({type:e,selectors:[["app-root"]],decls:3,vars:1,consts:[["contentId","main-content","type","overlay",4,"ngIf"],["id","main-content"],["contentId","main-content","type","overlay"],[1,"municipal-toolbar"],[1,"text-white","font-semibold","ml-3"],[1,"user-info","p-4","bg-gray-50","border-b","border-gray-200"],[1,"flex","items-center"],[1,"w-12","h-12","bg-primary","rounded-full","flex","items-center","justify-center","mr-3"],["name","person-outline",1,"text-white","text-xl"],[1,"flex-1"],[1,"font-semibold","text-gray-800","text-sm"],[1,"text-xs","text-gray-500"],[1,"py-2"],["autoHide","false",4,"ngFor","ngForOf"],[1,"mt-auto","p-4","border-t","border-gray-200"],["button","true",1,"menu-item","mb-2",3,"click"],["name","person-outline","slot","start","color","medium"],[1,"font-medium"],["button","true",1,"menu-item",3,"click"],["name","log-out-outline","slot","start","color","danger"],[1,"font-medium","text-red-600"],["autoHide","false"],["button","true","class","menu-item",3,"click",4,"ngIf"],["slot","start","color","medium",3,"name"]],template:function(o,i){o&1&&(p(0,"ion-app"),J(1,ht,26,3,"ion-menu",0),T(2,"ion-router-outlet",1),v()),o&2&&(P(),U("ngIf",i.isAuthenticated()))},dependencies:[we,be,ve,Ee,ke,Ue,Se,De,$e,Ie,Le,Te,Ke,Re,je],styles:[".municipal-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);--color: white}.user-info[_ngcontent-%COMP%]{background-color:#f9fafb;border-bottom:1px solid #e5e7eb}.menu-item[_ngcontent-%COMP%]{--padding-start: 1rem;--padding-end: 1rem;--border-radius: .5rem;margin:.25rem .5rem;transition:all .2s ease}.menu-item[_ngcontent-%COMP%]:hover{--background: #f3f4f6;transform:translate(4px)}.p-4[_ngcontent-%COMP%]{padding:1rem}.py-2[_ngcontent-%COMP%]{padding-top:.5rem;padding-bottom:.5rem}.mt-auto[_ngcontent-%COMP%]{margin-top:auto}.mb-2[_ngcontent-%COMP%]{margin-bottom:.5rem}.mr-3[_ngcontent-%COMP%]{margin-right:.75rem}.bg-gray-50[_ngcontent-%COMP%]{background-color:#f9fafb}.bg-primary[_ngcontent-%COMP%]{background-color:var(--primary)}.border-b[_ngcontent-%COMP%]{border-bottom-width:1px}.border-t[_ngcontent-%COMP%]{border-top-width:1px}.border-gray-200[_ngcontent-%COMP%]{border-color:#e5e7eb}.flex[_ngcontent-%COMP%]{display:flex}.flex-1[_ngcontent-%COMP%]{flex:1 1 0%}.items-center[_ngcontent-%COMP%]{align-items:center}.w-12[_ngcontent-%COMP%]{width:3rem}.h-12[_ngcontent-%COMP%]{height:3rem}.rounded-full[_ngcontent-%COMP%]{border-radius:9999px}.justify-center[_ngcontent-%COMP%]{justify-content:center}.text-white[_ngcontent-%COMP%]{color:#fff}.text-gray-500[_ngcontent-%COMP%]{color:#6b7280}.text-gray-800[_ngcontent-%COMP%]{color:#1f2937}.text-red-600[_ngcontent-%COMP%]{color:#dc2626}.text-xs[_ngcontent-%COMP%]{font-size:.75rem;line-height:1rem}.text-sm[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.text-xl[_ngcontent-%COMP%]{font-size:1.25rem;line-height:1.75rem}.font-medium[_ngcontent-%COMP%]{font-weight:500}.font-semibold[_ngcontent-%COMP%]{font-weight:600}ion-menu[_ngcontent-%COMP%]{--width: 280px}ion-menu[_ngcontent-%COMP%]   ion-content[_ngcontent-%COMP%]{--padding-bottom: 0}ion-list[_ngcontent-%COMP%]{padding:.5rem 0}"]});let t=e;return t})();var $=function(t){return t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE",t}($||{}),j=class extends Error{constructor(e,n,r){super(e),this.message=e,this.code=n,this.data=r}},ft=t=>{var e,n;return t!=null&&t.androidBridge?"android":!((n=(e=t==null?void 0:t.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},pt=t=>{let e=t.CapacitorCustomPlatform||null,n=t.Capacitor||{},r=n.Plugins=n.Plugins||{},o=()=>e!==null?e.name:ft(t),i=()=>o()!=="web",s=u=>{let d=C.get(u);return!!(d!=null&&d.platforms.has(o())||a(u))},a=u=>{var d;return(d=n.PluginHeaders)===null||d===void 0?void 0:d.find(K=>K.name===u)},h=u=>t.console.error(u),C=new Map,H=(u,d={})=>{let K=C.get(u);if(K)return console.warn(`Capacitor plugin "${u}" already registered. Cannot register plugins twice.`),K.proxy;let k=o(),S=a(u),_,ct=()=>c(null,null,function*(){return!_&&k in d?_=typeof d[k]=="function"?_=yield d[k]():_=d[k]:e!==null&&!_&&"web"in d&&(_=typeof d.web=="function"?_=yield d.web():_=d.web),_}),lt=(m,f)=>{var w,A;if(S){let x=S==null?void 0:S.methods.find(b=>f===b.name);if(x)return x.rtype==="promise"?b=>n.nativePromise(u,f.toString(),b):(b,V)=>n.nativeCallback(u,f.toString(),b,V);if(m)return(w=m[f])===null||w===void 0?void 0:w.bind(m)}else{if(m)return(A=m[f])===null||A===void 0?void 0:A.bind(m);throw new j(`"${u}" plugin is not implemented on ${k}`,$.Unimplemented)}},Y=m=>{let f,w=(...A)=>{let x=ct().then(b=>{let V=lt(b,m);if(V){let q=V(...A);return f=q==null?void 0:q.remove,q}else throw new j(`"${u}.${m}()" is not implemented on ${k}`,$.Unimplemented)});return m==="addListener"&&(x.remove=()=>c(null,null,function*(){return f()})),x};return w.toString=()=>`${m.toString()}() { [capacitor code] }`,Object.defineProperty(w,"name",{value:m,writable:!1,configurable:!1}),w},se=Y("addListener"),ae=Y("removeListener"),ut=(m,f)=>{let w=se({eventName:m},f),A=()=>c(null,null,function*(){let b=yield w;ae({eventName:m,callbackId:b},f)}),x=new Promise(b=>w.then(()=>b({remove:A})));return x.remove=()=>c(null,null,function*(){console.warn("Using addListener() without 'await' is deprecated."),yield A()}),x},Z=new Proxy({},{get(m,f){switch(f){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return S?ut:se;case"removeListener":return ae;default:return Y(f)}}});return r[u]=Z,C.set(u,{name:u,proxy:Z,platforms:new Set([...Object.keys(d),...S?[k]:[]])}),Z};return n.convertFileSrc||(n.convertFileSrc=u=>u),n.getPlatform=o,n.handleError=h,n.isNativePlatform=i,n.isPluginAvailable=s,n.registerPlugin=H,n.Exception=j,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},gt=t=>t.Capacitor=pt(t),D=gt(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),st=D.registerPlugin,X=class{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,n){let r=!1;this.listeners[e]||(this.listeners[e]=[],r=!0),this.listeners[e].push(n);let i=this.windowListeners[e];i&&!i.registered&&this.addWindowListener(i),r&&this.sendRetainedArgumentsForEvent(e);let s=()=>c(this,null,function*(){return this.removeListener(e,n)});return Promise.resolve({remove:s})}removeAllListeners(){return c(this,null,function*(){this.listeners={};for(let e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}})}notifyListeners(e,n,r){let o=this.listeners[e];if(!o){if(r){let i=this.retainedEventArguments[e];i||(i=[]),i.push(n),this.retainedEventArguments[e]=i}return}o.forEach(i=>i(n))}hasListeners(e){var n;return!!(!((n=this.listeners[e])===null||n===void 0)&&n.length)}registerWindowListener(e,n){this.windowListeners[n]={registered:!1,windowEventName:e,pluginEventName:n,handler:r=>{this.notifyListeners(n,r)}}}unimplemented(e="not implemented"){return new D.Exception(e,$.Unimplemented)}unavailable(e="not available"){return new D.Exception(e,$.Unavailable)}removeListener(e,n){return c(this,null,function*(){let r=this.listeners[e];if(!r)return;let o=r.indexOf(n);this.listeners[e].splice(o,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])})}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){let n=this.retainedEventArguments[e];n&&(delete this.retainedEventArguments[e],n.forEach(r=>{this.notifyListeners(e,r)}))}};var ot=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),it=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),re=class extends X{getCookies(){return c(this,null,function*(){let e=document.cookie,n={};return e.split(";").forEach(r=>{if(r.length<=0)return;let[o,i]=r.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");o=it(o).trim(),i=it(i).trim(),n[o]=i}),n})}setCookie(e){return c(this,null,function*(){try{let n=ot(e.key),r=ot(e.value),o=`; expires=${(e.expires||"").replace("expires=","")}`,i=(e.path||"/").replace("path=",""),s=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${n}=${r||""}${o}; path=${i}; ${s};`}catch(n){return Promise.reject(n)}})}deleteCookie(e){return c(this,null,function*(){try{document.cookie=`${e.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}})}clearCookies(){return c(this,null,function*(){try{let e=document.cookie.split(";")||[];for(let n of e)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}})}clearAllCookies(){return c(this,null,function*(){try{yield this.clearCookies()}catch(e){return Promise.reject(e)}})}},Zt=st("CapacitorCookies",{web:()=>new re}),bt=t=>c(null,null,function*(){return new Promise((e,n)=>{let r=new FileReader;r.onload=()=>{let o=r.result;e(o.indexOf(",")>=0?o.split(",")[1]:o)},r.onerror=o=>n(o),r.readAsDataURL(t)})}),vt=(t={})=>{let e=Object.keys(t);return Object.keys(t).map(o=>o.toLocaleLowerCase()).reduce((o,i,s)=>(o[i]=t[e[s]],o),{})},wt=(t,e=!0)=>t?Object.entries(t).reduce((r,o)=>{let[i,s]=o,a,h;return Array.isArray(s)?(h="",s.forEach(C=>{a=e?encodeURIComponent(C):C,h+=`${i}=${a}&`}),h.slice(0,-1)):(a=e?encodeURIComponent(s):s,h=`${i}=${a}`),`${r}&${h}`},"").substr(1):null,yt=(t,e={})=>{let n=Object.assign({method:t.method||"GET",headers:t.headers},e),o=vt(t.headers)["content-type"]||"";if(typeof t.data=="string")n.body=t.data;else if(o.includes("application/x-www-form-urlencoded")){let i=new URLSearchParams;for(let[s,a]of Object.entries(t.data||{}))i.set(s,a);n.body=i.toString()}else if(o.includes("multipart/form-data")||t.data instanceof FormData){let i=new FormData;if(t.data instanceof FormData)t.data.forEach((a,h)=>{i.append(h,a)});else for(let a of Object.keys(t.data))i.append(a,t.data[a]);n.body=i;let s=new Headers(n.headers);s.delete("content-type"),n.headers=s}else(o.includes("application/json")||typeof t.data=="object")&&(n.body=JSON.stringify(t.data));return n},oe=class extends X{request(e){return c(this,null,function*(){let n=yt(e,e.webFetchExtra),r=wt(e.params,e.shouldEncodeUrlParams),o=r?`${e.url}?${r}`:e.url,i=yield fetch(o,n),s=i.headers.get("content-type")||"",{responseType:a="text"}=i.ok?e:{};s.includes("application/json")&&(a="json");let h,C;switch(a){case"arraybuffer":case"blob":C=yield i.blob(),h=yield bt(C);break;case"json":h=yield i.json();break;case"document":case"text":default:h=yield i.text()}let H={};return i.headers.forEach((u,d)=>{H[d]=u}),{data:h,headers:H,status:i.status,url:i.url}})}get(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))})}post(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))})}put(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))})}patch(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))})}delete(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))})}},en=st("CapacitorHttp",{web:()=>new oe});var F=!1,ie=new ue(null),I=[],at=(t,e)=>{let n=g(M);if(!t.url.includes("/api/"))return e(t);let r=D.isNativePlatform(),o=t.clone({setHeaders:ce({"Content-Type":"application/json"},r&&{"Access-Control-Allow-Credentials":"true"}),withCredentials:!0});return e(o).pipe(fe({count:1,delay:(i,s)=>{if(i.status===0||i.status>=500)return console.log(`\u{1F504} Retrying request ${s}/1 due to network error`),W(1e3);throw i}}),te(i=>i.status===401&&!xt(t.url)?(console.log("\u{1F504} Token expirado, intentando renovar..."),Ct(o,e,n)):ee(()=>i)))};function Ct(t,e,n){return F?(console.log("\u23F3 Agregando petici\xF3n a la cola de espera..."),new le(r=>{I.push({request:t.clone({withCredentials:!0}),next:e,resolve:o=>{r.next(o),r.complete()},reject:o=>{r.error(o)}})})):(F=!0,ie.next(null),console.log("\u{1F504} Iniciando renovaci\xF3n de token..."),n.refreshToken().pipe(pe(()=>(console.log("\u2705 Token renovado exitosamente en interceptor"),F=!1,ie.next(!0),_t(),e(t.clone({withCredentials:!0})))),te(r=>(console.log("\u274C Error al renovar token en interceptor:",r),F=!1,ie.next(null),At(r),r.status===401&&(console.log("\u{1F6AB} Refresh token expirado, forzando logout"),n.forceLogout()),ee(()=>r))),he(()=>{F=!1})))}function _t(){console.log(`\u{1F504} Procesando ${I.length} peticiones pendientes...`),I.forEach(({request:t,next:e,resolve:n,reject:r})=>{e(t).subscribe({next:n,error:r})}),I=[]}function At(t){console.log(`\u274C Rechazando ${I.length} peticiones pendientes...`),I.forEach(({reject:e})=>{e(t)}),I=[]}function xt(t){return t.includes("/auth/login")||t.includes("/auth/refresh")||t.includes("/auth/profile")||t.includes("/auth/logout")}ye(rt,{providers:[Ze,et,{provide:Ae,useClass:Me},Fe(),Pe(nt,Oe(xe)),Ce(_e([at]))]});
