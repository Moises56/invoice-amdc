import{a as he}from"./chunk-EFKYVIZ2.js";import"./chunk-WJYYOXGJ.js";import"./chunk-GYW6ZFL4.js";import"./chunk-76SUSZ7P.js";import{Ba as pe,Ka as ue,La as fe,Q as le,X as me,Xa as ge,a as ae,i as se,ra as de,xa as ce}from"./chunk-PIGH2764.js";import{$ as ne,N as X,P as Y,R as Z,W as ee,Y as te,aa as oe,b as D,fa as ie,g as j,i as R,j as $,p as H,r as J,v as K,y as Q,z as W}from"./chunk-SOBSCE5F.js";import{b as re}from"./chunk-OKK4U6ED.js";import"./chunk-EDQZMFWJ.js";import"./chunk-AL5IVEPX.js";import{$a as z,A as M,B as O,I as y,J as i,Ka as T,M as k,Pb as g,Q as u,Qb as N,Rb as V,Sa as U,T as d,Tb as L,Ub as q,V as P,Vb as A,Y as s,Yb as B,Z as o,_ as p,_b as G,ca as E,da as C,ea as f,ma as m,na as x,oa as _,x as h}from"./chunk-WYTV4Y2I.js";import"./chunk-OQQFKM4V.js";import"./chunk-QUJFQN2Y.js";import"./chunk-J7JITKZC.js";import"./chunk-BOXIHRYD.js";import"./chunk-OHGEMRV5.js";import"./chunk-XQESWZ4T.js";import"./chunk-7KGURMOZ.js";import"./chunk-KLXKYU2M.js";import"./chunk-SIK2P2H5.js";import"./chunk-4BNUL4C7.js";import"./chunk-M66VC23L.js";import"./chunk-JMWLUS2D.js";import"./chunk-EUVXMWSF.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-USUO6L27.js";import"./chunk-CKP3SGE2.js";import"./chunk-2LFY4CRM.js";import"./chunk-PJL56ILQ.js";import"./chunk-NVWEJ7GR.js";import"./chunk-UVAVEIEI.js";import"./chunk-E6CW6KXY.js";import"./chunk-Z3EESIK6.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-6WKZVARI.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as v,b as S,h as w}from"./chunk-LNJ3S2LQ.js";function _e(r,c){if(r&1){let l=E();s(0,"ion-button",37),C("click",function(){M(l);let n=f();return O(n.editMode=!0)}),p(1,"ion-icon",38),o()}}function be(r,c){if(r&1){let l=E();s(0,"ion-button",39),C("click",function(){M(l);let n=f();return O(n.cancelEdit())}),p(1,"ion-icon",40),o()}}function Pe(r,c){if(r&1&&(s(0,"div",41),m(1),o()),r&2){let l=f();i(),_(" ",l.getErrorMessage(l.profileForm,"name")," ")}}function we(r,c){if(r&1&&(s(0,"div",41),m(1),o()),r&2){let l=f();i(),_(" ",l.getErrorMessage(l.profileForm,"email")," ")}}function Ce(r,c){r&1&&p(0,"ion-spinner",45)}function xe(r,c){r&1&&p(0,"ion-icon",46)}function ve(r,c){if(r&1&&(s(0,"ion-button",42),u(1,Ce,1,0,"ion-spinner",43)(2,xe,1,0,"ion-icon",44),m(3," Guardar Cambios "),o()),r&2){let l=f();d("disabled",l.profileForm.invalid||l.isLoading()),i(),d("ngIf",l.isLoading()),i(),d("ngIf",!l.isLoading())}}function Me(r,c){if(r&1&&(s(0,"div",41),m(1),o()),r&2){let l=f();i(),_(" ",l.getErrorMessage(l.passwordForm,"currentPassword")," ")}}function Oe(r,c){if(r&1&&(s(0,"div",41),m(1),o()),r&2){let l=f();i(),_(" ",l.getErrorMessage(l.passwordForm,"newPassword")," ")}}function ye(r,c){if(r&1&&(s(0,"div",41),m(1),o()),r&2){let l=f();i(),_(" ",l.getErrorMessage(l.passwordForm,"confirmPassword")," ")}}var Be=(()=>{let c=class c{constructor(){this.editMode=!1,this.formBuilder=h(B),this.authService=h(re),this.usuariosService=h(he),this.router=h(z),this.toastController=h(te),this.loadingController=h(ee),this.isLoading=y(!1),this.currentUser=y(null),ae({createOutline:me,closeOutline:le,personOutline:ue,saveOutline:ge,keyOutline:de,mailOutline:pe,phonePortraitOutline:fe,locationOutline:ce,arrowBackOutline:se}),this.profileForm=this.formBuilder.group({name:["",[g.required,g.minLength(2)]],email:["",[g.required,g.email]],phone:[""],address:[""]}),this.passwordForm=this.formBuilder.group({currentPassword:["",[g.required]],newPassword:["",[g.required,g.minLength(6)]],confirmPassword:["",[g.required]]},{validators:this.passwordMatchValidator})}ngOnInit(){this.loadProfile();let t=this.currentUser();t&&this.profileForm.patchValue({name:t.name,email:t.email,phone:t.phone||"",address:t.address||""})}cancelEdit(){this.editMode=!1;let t=this.currentUser();t&&this.profileForm.patchValue({name:t.name,email:t.email,phone:t.phone||"",address:t.address||""}),this.profileForm.markAsPristine(),this.profileForm.markAsUntouched()}loadProfile(){return w(this,null,function*(){this.isLoading.set(!0);try{let t=this.authService.user();if(t){let n=S(v({},t),{name:t.name||(t.nombre?`${t.nombre} ${t.apellido||""}`.trim():""),email:t.email||t.correo||"",phone:t.phone||t.telefono||"",address:t.address||""});this.currentUser.set(n),this.profileForm.patchValue({name:n.name,email:n.email,phone:n.phone,address:n.address})}}catch{yield this.showToast("Error al cargar perfil","danger")}finally{this.isLoading.set(!1)}})}updateProfile(){return w(this,null,function*(){var t;if(this.profileForm.valid){this.editMode=!1;let n=yield this.loadingController.create({message:"Actualizando perfil..."});yield n.present();try{let e=this.currentUser();if(!e)return;let a=this.profileForm.value;yield this.usuariosService.updateUser(e.id,a).toPromise(),yield this.showToast("Perfil actualizado correctamente","success")}catch(e){let a=((t=e==null?void 0:e.error)==null?void 0:t.message)||"Error al actualizar perfil";yield this.showToast(a,"danger")}finally{yield n.dismiss()}}else yield this.showToast("Por favor, complete todos los campos requeridos","warning"),this.markFormGroupTouched(this.profileForm)})}changePassword(){return w(this,null,function*(){var t;if(this.passwordForm.valid){let n=yield this.loadingController.create({message:"Cambiando contrase\xF1a..."});yield n.present();try{let e=this.currentUser();if(!e)return;let{newPassword:a}=this.passwordForm.value;yield this.usuariosService.changePassword(e.id,a).toPromise(),this.passwordForm.reset(),yield this.showToast("Contrase\xF1a cambiada correctamente","success")}catch(e){let a=((t=e==null?void 0:e.error)==null?void 0:t.message)||"Error al cambiar contrase\xF1a";yield this.showToast(a,"danger")}finally{yield n.dismiss()}}else yield this.showToast("Por favor, complete todos los campos requeridos","warning"),this.markFormGroupTouched(this.passwordForm)})}passwordMatchValidator(t){var a;let n=t.get("newPassword"),e=t.get("confirmPassword");if(n!=null&&n.value&&(e!=null&&e.value)&&n.value!==e.value)return e==null||e.setErrors({passwordMismatch:!0}),{passwordMismatch:!0};if((a=e==null?void 0:e.errors)!=null&&a.passwordMismatch){let b=v({},e.errors);delete b.passwordMismatch,e.setErrors(Object.keys(b).length?b:null)}return null}markFormGroupTouched(t){Object.keys(t.controls).forEach(n=>{let e=t.get(n);e==null||e.markAsTouched()})}hasError(t,n,e){let a=t.get(n);return a?e?a.hasError(e)&&a.touched:a.invalid&&a.touched:!1}getErrorMessage(t,n){let e=t.get(n);if(!e||!e.errors||!e.touched)return"";let a=e.errors;return a.required?"Este campo es requerido":a.email?"Ingrese un email v\xE1lido":a.minlength?`M\xEDnimo ${a.minlength.requiredLength} caracteres`:a.passwordMismatch?"Las contrase\xF1as no coinciden":"Campo inv\xE1lido"}goBack(){this.router.navigate(["/dashboard"])}showToast(t,n){return w(this,null,function*(){yield(yield this.toastController.create({message:t,duration:3e3,color:n,position:"top"})).present()})}getInitials(t){return t.split(" ").map(n=>n[0]).join("").toUpperCase().substring(0,2)}};c.\u0275fac=function(n){return new(n||c)},c.\u0275cmp=k({type:c,selectors:[["app-profile"]],decls:72,vars:30,consts:[[1,"municipal-toolbar"],["slot","start"],["defaultHref","/dashboard"],[1,"text-white","font-semibold"],[1,"bg-gray-50"],[1,"profile-container"],[1,"profile-header",2,"position","relative"],[1,"avatar","mb-3"],[1,"w-full","h-full","bg-primary","rounded-full","flex","items-center","justify-center",2,"width","100px","height","100px"],[1,"text-black","text-2xl","font-bold"],[1,"user-name"],[1,"user-email"],["outline","",1,"user-role",3,"color"],["fill","clear","size","small","style","position:absolute;top:12px;right:12px;z-index:2;",3,"click",4,"ngIf"],["fill","clear","size","small","color","medium","style","position:absolute;top:12px;right:12px;z-index:2;",3,"click",4,"ngIf"],[1,"profile-section"],[1,"section-header"],["name","person-outline",1,"mr-2","text-primary"],[2,"padding","16px",3,"ngSubmit","formGroup"],["lines","none",1,"mb-3","rounded-lg","custom-input"],["position","stacked",1,"text-sm","font-medium","text-gray-700"],["formControlName","name","placeholder","Ingrese su nombre completo",1,"mt-1",3,"readonly"],["class","error-message",4,"ngIf"],["formControlName","email","type","email","placeholder","su-email@ejemplo.com",1,"mt-1",3,"readonly"],["formControlName","phone","type","tel","placeholder","N\xFAmero de tel\xE9fono",1,"mt-1",3,"readonly"],["formControlName","address","placeholder","Direcci\xF3n completa","rows","3",1,"mt-1",3,"readonly"],["expand","block","type","submit","class","mt-4",3,"disabled",4,"ngIf"],[1,"password-form"],[1,"form-header"],["name","key-outline",1,"mr-2","text-primary"],[3,"ngSubmit","formGroup"],["formControlName","currentPassword","type","password","placeholder","Ingrese su contrase\xF1a actual",1,"mt-1"],["formControlName","newPassword","type","password","placeholder","Ingrese la nueva contrase\xF1a",1,"mt-1"],["formControlName","confirmPassword","type","password","placeholder","Confirme la nueva contrase\xF1a",1,"mt-1"],[1,"form-buttons"],["type","submit",1,"save-button",3,"disabled"],["name","key-outline","slot","start"],["fill","clear","size","small",2,"position","absolute","top","12px","right","12px","z-index","2",3,"click"],["name","create-outline"],["fill","clear","size","small","color","medium",2,"position","absolute","top","12px","right","12px","z-index","2",3,"click"],["name","close-outline"],[1,"error-message"],["expand","block","type","submit",1,"mt-4",3,"disabled"],["name","crescent","slot","start",4,"ngIf"],["name","save-outline","slot","start",4,"ngIf"],["name","crescent","slot","start"],["name","save-outline","slot","start"]],template:function(n,e){if(n&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),p(3,"ion-back-button",2),o(),s(4,"ion-title",3),m(5,"Mi Perfil"),o()()(),s(6,"ion-content",4)(7,"div",5)(8,"div",6)(9,"ion-avatar",7)(10,"div",8)(11,"span",9),m(12),o()()(),s(13,"div",10),m(14),o(),s(15,"div",11),m(16),o(),s(17,"ion-chip",12)(18,"ion-label"),m(19),o()(),u(20,_e,2,0,"ion-button",13)(21,be,2,0,"ion-button",14),o(),s(22,"div",15)(23,"div",16)(24,"h3"),p(25,"ion-icon",17),m(26," Informaci\xF3n Personal"),o()(),s(27,"form",18),C("ngSubmit",function(){return e.updateProfile()}),s(28,"ion-item",19)(29,"ion-label",20),m(30," Nombre Completo * "),o(),p(31,"ion-input",21),o(),u(32,Pe,2,1,"div",22),s(33,"ion-item",19)(34,"ion-label",20),m(35," Correo Electr\xF3nico * "),o(),p(36,"ion-input",23),o(),u(37,we,2,1,"div",22),s(38,"ion-item",19)(39,"ion-label",20),m(40," Tel\xE9fono "),o(),p(41,"ion-input",24),o(),s(42,"ion-item",19)(43,"ion-label",20),m(44," Direcci\xF3n "),o(),p(45,"ion-textarea",25),o(),u(46,ve,4,3,"ion-button",26),o()(),s(47,"div",27)(48,"div",28)(49,"h3"),p(50,"ion-icon",29),m(51," Cambiar Contrase\xF1a"),o()(),s(52,"form",30),C("ngSubmit",function(){return e.changePassword()}),s(53,"ion-item",19)(54,"ion-label",20),m(55," Contrase\xF1a Actual * "),o(),p(56,"ion-input",31),o(),u(57,Me,2,1,"div",22),s(58,"ion-item",19)(59,"ion-label",20),m(60," Nueva Contrase\xF1a * "),o(),p(61,"ion-input",32),o(),u(62,Oe,2,1,"div",22),s(63,"ion-item",19)(64,"ion-label",20),m(65," Confirmar Nueva Contrase\xF1a * "),o(),p(66,"ion-input",33),o(),u(67,ye,2,1,"div",22),s(68,"div",34)(69,"ion-button",35),p(70,"ion-icon",36),m(71," Cambiar Contrase\xF1a "),o()()()()()()),n&2){let a,b,I,F;i(12),_(" ",e.currentUser()?e.getInitials(e.currentUser().name||e.currentUser().nombre||"U"):"U"," "),i(2),x(((a=e.currentUser())==null?null:a.name)||"Usuario"),i(2),x(((b=e.currentUser())==null?null:b.email)||"-"),i(),d("color",((I=e.currentUser())==null?null:I.role)==="ADMIN"?"danger":"primary"),i(2),x(((F=e.currentUser())==null?null:F.role)||"USUARIO"),i(),d("ngIf",!e.editMode),i(),d("ngIf",e.editMode),i(6),d("formGroup",e.profileForm),i(4),P("is-invalid",e.hasError(e.profileForm,"name")),d("readonly",!e.editMode),i(),d("ngIf",e.hasError(e.profileForm,"name")),i(4),P("is-invalid",e.hasError(e.profileForm,"email")),d("readonly",!e.editMode),i(),d("ngIf",e.hasError(e.profileForm,"email")),i(4),d("readonly",!e.editMode),i(4),d("readonly",!e.editMode),i(),d("ngIf",e.editMode),i(6),d("formGroup",e.passwordForm),i(4),P("is-invalid",e.hasError(e.passwordForm,"currentPassword")),i(),d("ngIf",e.hasError(e.passwordForm,"currentPassword")),i(4),P("is-invalid",e.hasError(e.passwordForm,"newPassword")),i(),d("ngIf",e.hasError(e.passwordForm,"newPassword")),i(4),P("is-invalid",e.hasError(e.passwordForm,"confirmPassword")),i(),d("ngIf",e.hasError(e.passwordForm,"confirmPassword")),i(2),d("disabled",e.passwordForm.invalid)}},dependencies:[U,T,G,L,N,V,q,A,J,K,Y,Z,$,R,ne,Q,W,oe,ie,j,H,D,X],styles:["ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #3880ff;--color: white}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{font-weight:600}ion-content[_ngcontent-%COMP%]{--background: #f5f5f5}.profile-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;padding:16px}.profile-header[_ngcontent-%COMP%]{text-align:center;padding:24px 16px;background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000001a}.profile-header[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:100px;height:100px;margin:0 auto 16px;border:4px solid #3880ff;box-shadow:0 4px 12px #00000026}.profile-header[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#1a1a1a;margin-bottom:8px}.profile-header[_ngcontent-%COMP%]   .user-email[_ngcontent-%COMP%]{color:#666;font-size:1rem}.profile-header[_ngcontent-%COMP%]   .user-role[_ngcontent-%COMP%]{margin-top:12px}.profile-section[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000001a;overflow:hidden}.profile-section[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]{padding:16px;background:#f8f9fa;border-bottom:1px solid #e9ecef}.profile-section[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;font-weight:600;color:#1a1a1a}.profile-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--border-color: #e9ecef;--padding-start: 16px;--padding-end: 16px}.profile-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#3880ff;margin-right:12px}.profile-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#1a1a1a;margin-bottom:4px}.profile-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:#666;margin:0}.action-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-top:24px}.action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-weight:500}.action-buttons[_ngcontent-%COMP%]   ion-button.edit-button[_ngcontent-%COMP%]{--background: #3880ff;--color: white}.action-buttons[_ngcontent-%COMP%]   ion-button.change-password-button[_ngcontent-%COMP%]{--background: #28a745;--color: white}.action-buttons[_ngcontent-%COMP%]   ion-button.logout-button[_ngcontent-%COMP%]{--background: #dc3545;--color: white}.password-form[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000001a;padding:20px;margin-top:16px}.password-form[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:24px}.password-form[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.2rem;font-weight:600;color:#1a1a1a}.password-form[_ngcontent-%COMP%]   .form-buttons[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:20px}.password-form[_ngcontent-%COMP%]   .form-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex:1;--border-radius: 8px;height:44px;font-weight:500}.password-form[_ngcontent-%COMP%]   .form-buttons[_ngcontent-%COMP%]   ion-button.save-button[_ngcontent-%COMP%]{--background: #28a745;--color: white}.password-form[_ngcontent-%COMP%]   .form-buttons[_ngcontent-%COMP%]   ion-button.cancel-button[_ngcontent-%COMP%]{--background: #6c757d;--color: white}.error-message[_ngcontent-%COMP%]{color:#dc3545;font-size:.85rem;margin-top:4px;margin-left:16px}@media (min-width: 768px){.profile-container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto}.action-buttons[_ngcontent-%COMP%]{flex-direction:row}.action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex:1}}"]});let r=c;return r})();export{Be as ProfilePage};
