####################APLICACION DE FRONTEND DE FACTURAS################################################################
# Configuración HTTP (Puerto 80)
<VirtualHost *:80>
    DocumentRoot "C:\xampp\htdocs\factus-amdc"
    ServerName facturas.amdc.hn
    
    # Redirigir todo el tráfico HTTP a HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
    
    ErrorLog C:\xampp\apache\logs\factus-amdc-fron-error.log
    CustomLog C:\xampp\apache\logs\factus-amdc-fron.log combined
</VirtualHost>

# Configuración HTTPS (Puerto 443)
<VirtualHost *:443>
    DocumentRoot "C:\xampp\htdocs\factus-amdc"
    ServerName facturas.amdc.hn
    
    # Configuración SSL
    SSLEngine on
    SSLCertificateFile C:\xampp\apache\crt\ssl_certs\contribuyente360.amdc.hn-crt.pem
    SSLCertificateKeyFile C:\xampp\apache\crt\ssl_certs\contribuyente360.amdc.hn-key.pem
    SSLCACertificateFile C:\xampp\apache\crt\ssl_certs\contribuyente360.amdc.hn-chain.pem
    
    # Configuración de directorio principal
    DirectoryIndex index.html
    
    <Directory "C:\xampp\htdocs\factus-amdc">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Configuración específica para Angular SPA
        FallbackResource /index.html
        
        # Habilitar compresión
        <IfModule mod_deflate.c>
            SetOutputFilter DEFLATE
            SetEnvIfNoCase Request_URI \\
                \.(?:gif|jpe?g|png)$ no-gzip dont-vary
            SetEnvIfNoCase Request_URI \\
                \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
        </IfModule>
        
        # Configuración de caché
        <IfModule mod_expires.c>
            ExpiresActive On
            ExpiresByType text/html "access plus 0 seconds"
            ExpiresByType text/css "access plus 1 year"
            ExpiresByType application/javascript "access plus 1 year"
            ExpiresByType image/png "access plus 1 year"
            ExpiresByType image/jpg "access plus 1 year"
            ExpiresByType image/jpeg "access plus 1 year"
            ExpiresByType image/gif "access plus 1 year"
            ExpiresByType image/svg+xml "access plus 1 year"
        </IfModule>
        
        # Headers de seguridad
        <IfModule mod_headers.c>
            Header always set X-Frame-Options "SAMEORIGIN"
            Header always set X-Content-Type-Options "nosniff"
            Header always set X-XSS-Protection "1; mode=block"
            Header always set Referrer-Policy "strict-origin-when-cross-origin"
            
            # CORS headers para API calls
            Header always set Access-Control-Allow-Origin "*"
            Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
            Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
            
            # Cache control para diferentes tipos de archivos
            <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg)$">
                Header set Cache-Control "max-age=31536000, public"
            </FilesMatch>
            
            <FilesMatch "\.(html)$">
                Header set Cache-Control "no-cache, no-store, must-revalidate"
                Header set Pragma "no-cache"
                Header set Expires "0"
            </FilesMatch>
        </IfModule>
    </Directory>
    
    # Configuración para manejar rutas de Angular
    RewriteEngine On
    
    # No reescribir archivos que existen físicamente
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    
    # Redirigir todas las rutas a index.html para Angular routing
    RewriteRule . /index.html [L]
    
    # Logs
    ErrorLog C:\xampp\apache\logs\factus-amdc-fron-error.log
    CustomLog C:\xampp\apache\logs\factus-amdc-fron.log combined
    
    # Log level para debugging (cambiar a 'warn' en producción)
    LogLevel info
</VirtualHost>

####################FIN APLICACION DE FRONTEND DE FACTURAS################################################################

# Notas importantes para la implementación:
# 1. Asegúrate de que los módulos mod_rewrite, mod_headers, mod_expires y mod_deflate estén habilitados
# 2. Verifica que la ruta del DocumentRoot sea correcta
# 3. Asegúrate de que los certificados SSL estén en las rutas especificadas
# 4. Reinicia Apache después de aplicar estos cambios
# 5. Verifica los logs de error si hay problemas