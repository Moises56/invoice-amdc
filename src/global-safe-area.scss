/* ===== SAFE AREA GLOBAL STYLES ===== */
/* Estilos unificados para safe area en todas las páginas */

// Variables globales para safe area - Mejoradas para dispositivos físicos
:root {
  --safe-area-color: #5ccedf;
  --safe-area-gradient: linear-gradient(135deg, #5ccedf 0%, #4db6c7 100%);
  
  // Safe area con fallbacks más robustos para dispositivos físicos
  --safe-area-top: env(safe-area-inset-top, 0px);
  --safe-area-left: env(safe-area-inset-left, 0px);
  --safe-area-right: env(safe-area-inset-right, 0px);
  --safe-area-bottom: env(safe-area-inset-bottom, 0px);
  
  // Fallbacks mínimos para cuando env() no funciona
  --safe-area-top-fallback: max(env(safe-area-inset-top, 0px), 44px);
  --safe-area-top-robust: max(env(safe-area-inset-top, 0px), 44px);
  --safe-area-left-fallback: max(env(safe-area-inset-left, 0px), 0px);
  --safe-area-right-fallback: max(env(safe-area-inset-right, 0px), 0px);
  --safe-area-bottom-fallback: max(env(safe-area-inset-bottom, 0px), 0px);
  
  --header-height: 56px;
  --header-total-height: calc(var(--safe-area-top-fallback) + var(--header-height));
}

// Mixin para headers con safe area - Optimizado para dispositivos físicos
@mixin safe-area-header($background-color: var(--safe-area-color)) {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  background: $background-color;
  
  &::after {
    display: none; // Remover línea de separación
  }
  
  // Safe area spacer - Mejorado para dispositivos físicos
  .safe-area-spacer {
    // Usar la variable con fallback robusto
    height: var(--safe-area-top-fallback);
    min-height: 44px;
    background: inherit;
    width: 100%;
    
    // Detección específica para dispositivos con notch/dynamic island
    @media screen and (min-device-width: 375px) and (max-device-width: 812px) and (-webkit-device-pixel-ratio: 3) {
      min-height: 44px;
    }
    
    // iPhone 14 Pro y similares con Dynamic Island
    @media screen and (min-device-width: 393px) and (max-device-width: 852px) and (-webkit-device-pixel-ratio: 3) {
      min-height: 59px;
    }
    
    // Fallback general para dispositivos modernos
    @supports (padding: max(0px)) {
      height: var(--safe-area-top-fallback);
      min-height: var(--safe-area-top-fallback);
    }
    
    // Fallback adicional si env() no está disponible
    @supports not (padding: env(safe-area-inset-top)) {
      height: 44px;
      min-height: 44px;
    }
  }
  
  ion-toolbar {
    --background: transparent;
    --color: white;
    --border-width: 0;
    --min-height: var(--header-height);
    --padding-start: max(var(--safe-area-left), 16px);
    --padding-end: max(var(--safe-area-right), 16px);
    
    ion-title {
      font-weight: 600;
      font-size: 18px;
      color: white !important;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      
      @media (min-width: 768px) {
        font-size: 20px;
      }
    }
    
    ion-back-button {
      --color: white;
      --icon-font-size: 24px;
    }
    
    ion-button {
      --color: white;
      
      &.notification-btn,
      &.menu-btn {
        --background: rgba(255, 255, 255, 0.15);
        --border-radius: 50%;
        width: 40px;
        height: 40px;
        
        &:hover {
          --background: rgba(255, 255, 255, 0.25);
        }
      }
    }
  }
}

// Mixin para content con safe area - Mejorado para dispositivos físicos
@mixin safe-area-content($padding-top: 32px) {
  --content-padding-top: calc(var(--header-total-height) + #{$padding-top});
  
  // Usar las variables con fallback para mejor compatibilidad
  padding-top: calc(var(--safe-area-top-fallback) + var(--header-height) + #{$padding-top}) !important;
  padding-left: max(var(--safe-area-left-fallback), 20px) !important;
  padding-right: max(var(--safe-area-right-fallback), 20px) !important;
  padding-bottom: max(var(--safe-area-bottom-fallback), 24px) !important;
  
  // Fallback robusto para dispositivos que no soportan env()
  @supports not (padding: env(safe-area-inset-top)) {
    padding-top: calc(44px + 56px + #{$padding-top}) !important;
  }
  
  // Optimización para dispositivos con notch/dynamic island
  @media screen and (min-device-width: 375px) and (max-device-width: 812px) and (-webkit-device-pixel-ratio: 3) {
    padding-top: calc(44px + 56px + #{$padding-top}) !important;
  }
  
  // iPhone 14 Pro y similares con Dynamic Island
  @media screen and (min-device-width: 393px) and (max-device-width: 852px) and (-webkit-device-pixel-ratio: 3) {
    padding-top: calc(59px + 56px + #{$padding-top}) !important;
  }
  
  @media (min-width: 768px) {
    padding-left: max(var(--safe-area-left-fallback), 32px) !important;
    padding-right: max(var(--safe-area-right-fallback), 32px) !important;
    padding-bottom: max(var(--safe-area-bottom-fallback), 32px) !important;
  }
  
  // Primer elemento con margen superior adicional
  > *:first-child {
    margin-top: 8px;
  }
}

// Clases utilitarias para aplicar safe area
.safe-area-header {
  @include safe-area-header();
}

.safe-area-header-custom {
  @include safe-area-header(var(--safe-area-gradient));
}

.safe-area-content {
  @include safe-area-content();
}

.safe-area-content-large {
  @include safe-area-content(40px);
}

// Estilos específicos para diferentes tipos de páginas
.dashboard-safe-area {
  .dashboard-header {
    @include safe-area-header(var(--safe-area-gradient));
  }
  
  .dashboard-content {
    @include safe-area-content(24px);
  }
}

.profile-safe-area {
  .profile-header {
    @include safe-area-header(var(--safe-area-gradient));
  }
  
  .profile-content {
    @include safe-area-content(32px);
  }
}

.consulta-safe-area {
  ion-header {
    @include safe-area-header(var(--safe-area-gradient));
  }
  
  ion-content {
    @include safe-area-content(24px);
  }
}

.estado-cuenta-safe-area {
  ion-header {
    @include safe-area-header(var(--safe-area-gradient));
  }
  
  ion-content {
    @include safe-area-content(24px);
  }
}

.reportes-safe-area {
  ion-header {
    @include safe-area-header(var(--safe-area-gradient));
  }
  
  ion-content {
    @include safe-area-content(24px);
  }
}

.stats-safe-area {
  ion-header {
    @include safe-area-header(var(--safe-area-gradient));
  }
  
  ion-content {
    @include safe-area-content(24px);
  }
}

.bluetooth-safe-area {
  ion-header {
    @include safe-area-header(var(--safe-area-gradient));
  }
  
  ion-content {
    @include safe-area-content(24px);
  }
}

.facturas-safe-area {
  ion-header {
    @include safe-area-header(var(--safe-area-gradient));
  }
  
  ion-content {
    @include safe-area-content(24px);
  }
}

.mercados-safe-area {
  ion-header {
    @include safe-area-header(var(--safe-area-gradient));
  }
  
  ion-content {
    @include safe-area-content(24px);
  }
}

.locales-safe-area {
  ion-header {
    @include safe-area-header(var(--safe-area-gradient));
  }
  
  ion-content {
    @include safe-area-content(24px);
  }
}

.usuarios-safe-area {
  ion-header {
    @include safe-area-header(var(--safe-area-gradient));
  }
  
  ion-content {
    @include safe-area-content(24px);
  }
}

.auditoria-safe-area {
  ion-header {
    @include safe-area-header(var(--safe-area-gradient));
  }
  
  ion-content {
    @include safe-area-content(24px);
  }
}

// Responsive adjustments
@media (max-width: 768px) {
  .safe-area-content {
    padding-left: max(var(--safe-area-left), 16px) !important;
    padding-right: max(var(--safe-area-right), 16px) !important;
  }
}

// Estilos adicionales para mejorar compatibilidad con dispositivos físicos

// Forzar recálculo del safe area en orientación landscape
@media (orientation: landscape) {
  :root {
    --safe-area-top-landscape: max(env(safe-area-inset-top, 0px), 0px);
    --safe-area-left-landscape: max(env(safe-area-inset-left, 0px), 0px);
    --safe-area-right-landscape: max(env(safe-area-inset-right, 0px), 0px);
  }
  
  .safe-area-spacer {
    height: var(--safe-area-top-landscape) !important;
    min-height: 0 !important;
  }
  
  .safe-area-content {
    padding-top: calc(var(--safe-area-top-landscape) + var(--header-height) + 20px) !important;
    padding-left: max(var(--safe-area-left-landscape), 20px) !important;
    padding-right: max(var(--safe-area-right-landscape), 20px) !important;
  }
}

// Estilos específicos para WebView (Capacitor)
@supports (-webkit-touch-callout: none) {
  .safe-area-header {
    // Asegurar que el header esté siempre visible
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }
  
  .safe-area-spacer {
    // Forzar repaint en WebView
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
  }
}

// Print styles - ocultar safe area spacers
@media print {
  .safe-area-spacer {
    display: none !important;
  }
  
  .safe-area-header {
    position: static !important;
    background: transparent !important;
  }
  
  .safe-area-content {
    padding-top: 0 !important;
  }
}