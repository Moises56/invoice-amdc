<ion-header>
  <ion-toolbar class="municipal-toolbar">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/usuarios"></ion-back-button>
    </ion-buttons>
    <ion-title class="text-white font-semibold">
      Detalle de Usuario
    </ion-title>
    <ion-buttons slot="end" *ngIf="user() && !isLoading()">
      <ion-button (click)="editUser()" fill="clear">
        <ion-icon name="create-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="bg-gray-50">
  <div class="p-4">
    
    <!-- Loading State -->
    <div *ngIf="isLoading()" class="space-y-4">
      <ion-card class="shadow-sm">
        <ion-card-content class="p-4">
          <div class="flex items-center space-x-4 mb-4">
            <ion-skeleton-text [animated]="true" style="width: 64px; height: 64px; border-radius: 50%"></ion-skeleton-text>
            <div class="flex-1">
              <ion-skeleton-text [animated]="true" style="width: 60%"></ion-skeleton-text>
              <ion-skeleton-text [animated]="true" style="width: 40%"></ion-skeleton-text>
            </div>
          </div>
          <ion-skeleton-text [animated]="true" style="width: 100%"></ion-skeleton-text>
          <ion-skeleton-text [animated]="true" style="width: 80%"></ion-skeleton-text>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- User Content -->
    <div *ngIf="!isLoading() && user()" class="space-y-4">
      
      <!-- Header Card -->
      <ion-card class="shadow-sm">
        <ion-card-content class="p-4">
          <div class="flex items-start space-x-4">
            <div class="w-16 h-16 bg-primary rounded-full flex items-center justify-center">
              <ion-icon name="person-outline" class="text-2xl text-white"></ion-icon>
            </div>
            <div class="flex-1 min-w-0">
              <h2 class="text-xl font-bold text-gray-900 truncate">
                {{ user()?.nombre }} {{ user()?.apellido }}
              </h2>
              <p class="text-sm text-gray-600 mb-2">{{ user()?.username }}</p>
              <ion-chip [color]="getRoleColor(user()!.role)" class="text-xs">
                {{ getRoleText(user()!.role) }}
              </ion-chip>
              <ion-chip 
                [color]="user()?.isActive ? 'success' : 'danger'" 
                class="text-xs ml-2">
                <ion-icon 
                  [name]="user()?.isActive ? 'checkmark-circle-outline' : 'close-circle-outline'" 
                  slot="start">
                </ion-icon>
                {{ user()?.isActive ? 'Activo' : 'Inactivo' }}
              </ion-chip>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Contact Information -->
      <ion-card class="shadow-sm">
        <ion-card-header class="pb-2">
          <ion-card-title class="text-lg text-gray-800 flex items-center">
            <ion-icon name="mail-outline" class="mr-2 text-primary"></ion-icon>
            Información de Contacto
          </ion-card-title>
        </ion-card-header>
        
        <ion-card-content class="pt-0">
          <ion-item lines="none" class="mb-2">
            <ion-icon name="mail-outline" slot="start" class="text-gray-500"></ion-icon>
            <ion-label>
              <h3 class="font-medium">Correo Electrónico</h3>
              <p class="text-gray-600">{{ user()?.correo }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item lines="none" class="mb-2" *ngIf="user()?.telefono">
            <ion-icon name="call-outline" slot="start" class="text-gray-500"></ion-icon>
            <ion-label>
              <h3 class="font-medium">Teléfono</h3>
              <p class="text-gray-600">{{ user()?.telefono }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item lines="none" class="mb-2" *ngIf="user()?.dni">
            <ion-icon name="card-outline" slot="start" class="text-gray-500"></ion-icon>
            <ion-label>
              <h3 class="font-medium">DNI</h3>
              <p class="text-gray-600">{{ user()?.dni }}</p>
            </ion-label>
          </ion-item>
        </ion-card-content>
      </ion-card>

      <!-- Work Information -->
      <ion-card class="shadow-sm">
        <ion-card-header class="pb-2">
          <ion-card-title class="text-lg text-gray-800 flex items-center">
            <ion-icon name="briefcase-outline" class="mr-2 text-primary"></ion-icon>
            Información Laboral
          </ion-card-title>
        </ion-card-header>
        
        <ion-card-content class="pt-0">
          <ion-item lines="none" class="mb-2" *ngIf="user()?.gerencia">
            <ion-icon name="business-outline" slot="start" class="text-gray-500"></ion-icon>
            <ion-label>
              <h3 class="font-medium">Gerencia</h3>
              <p class="text-gray-600">{{ user()?.gerencia }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item lines="none" class="mb-2" *ngIf="user()?.numero_empleado">
            <ion-icon name="keypad-outline" slot="start" class="text-gray-500"></ion-icon>
            <ion-label>
              <h3 class="font-medium">Número de Empleado</h3>
              <p class="text-gray-600">{{ user()?.numero_empleado }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item lines="none" class="mb-2">
            <ion-icon name="key-outline" slot="start" class="text-gray-500"></ion-icon>
            <ion-label>
              <h3 class="font-medium">Usuario del Sistema</h3>
              <p class="text-gray-600">{{ user()?.username }}</p>
            </ion-label>
          </ion-item>
        </ion-card-content>
      </ion-card>

      <!-- System Information -->
      <ion-card class="shadow-sm">
        <ion-card-header class="pb-2">
          <ion-card-title class="text-lg text-gray-800 flex items-center">
            <ion-icon name="keypad-outline" class="mr-2 text-primary"></ion-icon>
            Información del Sistema
          </ion-card-title>
        </ion-card-header>
        
        <ion-card-content class="pt-0">
          <ion-item lines="none" class="mb-2">
            <ion-icon name="person-outline" slot="start" class="text-gray-500"></ion-icon>
            <ion-label>
              <h3 class="font-medium">ID de Usuario</h3>
              <p class="text-gray-600 text-xs font-mono">{{ user()?.id }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item lines="none" class="mb-2" *ngIf="user()?.createdAt">
            <ion-icon name="calendar-outline" slot="start" class="text-gray-500"></ion-icon>
            <ion-label>
              <h3 class="font-medium">Fecha de Creación</h3>
              <p class="text-gray-600">{{ user()?.createdAt | date:'medium' }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item lines="none" class="mb-2" *ngIf="user()?.updatedAt">
            <ion-icon name="refresh-outline" slot="start" class="text-gray-500"></ion-icon>
            <ion-label>
              <h3 class="font-medium">Última Actualización</h3>
              <p class="text-gray-600">{{ user()?.updatedAt | date:'medium' }}</p>
            </ion-label>
          </ion-item>
        </ion-card-content>
      </ion-card>

      <!-- Actions -->
      <div class="flex gap-3 mt-6">
        <ion-button 
          expand="block" 
          fill="outline" 
          color="medium"
          (click)="goBack()"
          class="flex-1">
          <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
          Volver
        </ion-button>
        
        <ion-button 
          expand="block" 
          (click)="editUser()"
          class="flex-1">
          <ion-icon name="create-outline" slot="start"></ion-icon>
          Editar
        </ion-button>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="!isLoading() && !user()" class="text-center py-8">
      <ion-icon name="alert-circle-outline" class="text-6xl text-gray-400 mb-4"></ion-icon>
      <h2 class="text-xl font-semibold text-gray-700 mb-2">Usuario no encontrado</h2>
      <p class="text-gray-500 mb-4">El usuario que buscas no existe o ha sido eliminado.</p>
      <ion-button fill="outline" (click)="goBack()">
        <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
        Volver a la lista
      </ion-button>
    </div>

  </div>
</ion-content>
