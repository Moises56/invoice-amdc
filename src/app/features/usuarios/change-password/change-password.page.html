<ion-header>
  <ion-toolbar class="municipal-toolbar">
    <ion-title class="modal-title">
      游댏 Cambiar Contrase침a
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="close()" fill="clear" class="close-btn-modern">
        <ion-icon name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="password-change-content">
  <div class="p-4">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      
      <!-- Informaci칩n de seguridad -->
      <ion-card class="shadow-sm mb-4">
        <ion-card-header class="pb-2">
          <ion-card-title class="card-title-modern">
            <ion-icon name="key-outline" class="title-icon"></ion-icon>
            {{ isAdmin ? 'Restablecer Contrase침a de Usuario' : 'Cambiar Mi Contrase침a' }}
          </ion-card-title>
        </ion-card-header>
        
        <ion-card-content class="pt-0">
          <!-- Contrase침a actual (solo para usuarios no admin) -->
          <ion-item 
            *ngIf="!isAdmin"
            class="mb-3 rounded-lg custom-input" 
            lines="none">
            <ion-label position="stacked" class="input-label-modern">
              Contrase침a Actual *
            </ion-label>
            <ion-input
              formControlName="currentPassword"
              type="password"
              placeholder="Ingrese su contrase침a actual"
              [class.is-invalid]="hasError('currentPassword')"
              class="mt-1">
            </ion-input>
          </ion-item>
          <div *ngIf="hasError('currentPassword')" class="error-message">
            {{ getErrorMessage('currentPassword') }}
          </div>

          <!-- Nueva contrase침a -->
          <ion-item class="mb-3 rounded-lg custom-input" lines="none">
            <ion-label position="stacked" class="input-label-modern">
              Nueva Contrase침a *
            </ion-label>
            <ion-input
              formControlName="newPassword"
              type="password"
              placeholder="Ingrese la nueva contrase침a"
              [class.is-invalid]="hasError('newPassword')"
              class="mt-1">
            </ion-input>
          </ion-item>
          <div *ngIf="hasError('newPassword')" class="error-message">
            {{ getErrorMessage('newPassword') }}
          </div>

          <!-- Indicador de fuerza de contrase침a -->
          <div class="password-strength mt-2" *ngIf="form.get('newPassword')?.value">
            <div class="strength-meter" [attr.data-strength]="getPasswordStrength()">
              <div class="strength-fill"></div>
            </div>
            <span class="strength-text" [attr.data-strength]="getPasswordStrength()">
              Fuerza: {{ getPasswordStrengthText() }}
            </span>
          </div>

          <!-- Confirmar nueva contrase침a -->
          <ion-item class="mb-3 rounded-lg custom-input" lines="none">
            <ion-label position="stacked" class="input-label-modern">
              Confirmar Nueva Contrase침a *
            </ion-label>
            <ion-input
              formControlName="confirmPassword"
              type="password"
              placeholder="Confirme la nueva contrase침a"
              [class.is-invalid]="hasError('confirmPassword')"
              class="mt-1">
            </ion-input>
          </ion-item>
          <div *ngIf="hasError('confirmPassword')" class="error-message">
            {{ getErrorMessage('confirmPassword') }}
          </div>

          <!-- Informaci칩n de seguridad -->
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mt-4">
            <div class="flex items-start">
              <ion-icon name="lock-closed-outline" class="text-blue-500 mr-2 mt-1"></ion-icon>
              <div class="text-sm text-blue-700">
                <p class="font-medium mb-1">Requisitos de contrase침a:</p>
                <ul class="list-disc list-inside space-y-1 text-xs">
                  <li class="password-req" [class.met]="hasMinLength()">
                    M칤nimo 8 caracteres
                  </li>
                  <li class="password-req" [class.met]="hasUpperCase()">
                    Al menos una letra may칰scula
                  </li>
                  <li class="password-req" [class.met]="hasLowerCase()">
                    Al menos una letra min칰scula
                  </li>
                  <li class="password-req" [class.met]="hasNumbers()">
                    Al menos un n칰mero
                  </li>
                  <li class="password-req" [class.met]="hasSymbols()">
                    Al menos un s칤mbolo (especiales)
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Botones de acci칩n modernos -->
      <div class="action-buttons">
        <ion-button 
          fill="solid" 
          (click)="close()"
          class="secondary-btn">
          <ion-icon name="close-outline" slot="start"></ion-icon>
          Cancelar
        </ion-button>
        
        <ion-button 
          fill="solid"
          type="submit"
          [disabled]="form.invalid || isLoading()"
          class="primary-btn">
          <ion-spinner *ngIf="isLoading()" name="crescent" slot="start"></ion-spinner>
          <ion-icon *ngIf="!isLoading()" name="save-outline" slot="start"></ion-icon>
          {{ isAdmin ? 'Restablecer' : 'Actualizar' }}
        </ion-button>
      </div>

      <!-- Debug info (solo para desarrollo) -->
      <div class="mt-4 p-3 bg-gray-100 rounded text-xs" *ngIf="false">
        <p><strong>Form Valid:</strong> {{ form.valid }}</p>
        <p><strong>Form Errors:</strong> {{ getFormErrors() }}</p>
        <p><strong>Is Admin:</strong> {{ isAdmin }}</p>
      </div>
    </form>
  </div>
</ion-content>
