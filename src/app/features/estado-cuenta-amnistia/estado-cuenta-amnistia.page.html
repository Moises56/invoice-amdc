
<ion-header class="amnistia-header">
  <ion-toolbar class="amnistia-toolbar">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title class="amnistia-title">Estado de Cuenta con Amnistía</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="estado-cuenta-amnistia-bg">
  <div class="estado-cuenta-container">
    <div class="search-form glass-card">
      <app-search-input
        (search)="onSearch($event)"
        (clear)="onClearSearch()"
        [disabled]="isLoading()"
        placeholder="Buscar estado de cuenta...">
      </app-search-input>
      
      <!-- Mostrar resumen de búsqueda -->
      <div *ngIf="lastSearchParams" class="search-summary">
        <ion-chip color="primary" outline="true">
          <ion-icon name="search-outline"></ion-icon>
          <ion-label>{{ getSearchSummary() }}</ion-label>
        </ion-chip>
      </div>
      
      <!-- Mostrar errores de búsqueda -->
      <div *ngIf="searchError()" class="search-error">
        <ion-item color="danger" lines="none">
          <ion-icon name="alert-circle" slot="start"></ion-icon>
          <ion-label class="ion-text-wrap">{{ searchError() }}</ion-label>
        </ion-item>
      </div>
    </div>

    <div *ngIf="isLoading()" class="ion-text-center amnistia-loading">
      <ion-spinner name="crescent"></ion-spinner>
    </div>

    <div *ngIf="!isLoading() && estadoCuenta() as data">
      <div class="amnistia-card glass-card">
        <div class="amnistia-card-header">
          <div class="amnistia-avatar">
            <ion-icon name="person-circle-outline" color="primary" style="font-size:2.5rem;"></ion-icon>
          </div>
          <div>
            <div class="amnistia-nombre">{{ data.nombre }}</div>
            <div class="amnistia-identidad">{{ data.identidad }}</div>
          </div>
        </div>
        <div class="amnistia-card-content">
          <div><strong>Clave Catastral:</strong> {{ data.claveCatastral }}</div>
          <div><strong>Colonia:</strong> {{ data.colonia }}</div>
          <div><strong>Fecha:</strong> {{ data.fecha }} - {{ data.hora }}</div>
        </div>
      </div>

      <div *ngIf="data.amnistiaVigente" class="amnistia-alert glass-card">
        <ion-icon name="shield-checkmark-outline" color="success" style="font-size:2rem;"></ion-icon>
        <div>
          <div class="amnistia-alert-title">Amnistía Vigente</div>
          <div class="amnistia-alert-desc">Aproveche la amnistía hasta el: <strong>{{ data.fechaFinAmnistia }}</strong></div>
        </div>
      </div>

      <div class="detail-card glass-card" style="margin-bottom: 5rem;">
        <div class="detail-header">
          <h3>Detalle de Mora con Amnistía</h3>
          <ion-button 
            fill="outline" 
            size="small" 
            (click)="imprimirRecibo()"
            [disabled]="isLoading() || !estadoCuenta()">
            <ion-icon name="print-outline" slot="start"></ion-icon>
            Imprimir
          </ion-button>
        </div>
        
        <div class="table-container">
          <table class="detail-table">
            <thead>
              <tr>
                <th>Año</th>
                <th>Impuesto</th>
                <th>T. Aseo</th>
                <th>Bomberos</th>
                <th>Recargo</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let detalle of data.detallesMora" class="detail-row">
                <td class="year-cell">{{ detalle.year }}</td>
                <td>{{ detalle.impuesto }}</td>
                <td>{{ detalle.trenDeAseo }}</td>
                <td>{{ detalle.tasaBomberos }}</td>
                <td>{{ detalle.recargo }}</td>
                <td class="total-cell"><strong>{{ detalle.total }}</strong></td>
              </tr>
            </tbody>
            <tfoot>
              <tr class="total-row">
                <td colspan="5"><strong>TOTAL GENERAL</strong></td>
                <td class="total-cell"><strong>{{ data.totalGeneral }}</strong></td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
  </div>
</ion-content>

<style>
.amnistia-bg {
  --background: linear-gradient(135deg, #e0f7fa 0%, #f8fafc 100%) !important;
  background: linear-gradient(135deg, #e0f7fa 0%, #f8fafc 100%) !important;
}
.amnistia-header, .amnistia-toolbar {
  background: linear-gradient(90deg, #5ccedf 60%, #A4C9F5 100%) !important;
  box-shadow: 0 2px 12px #5ccedf33;
}
.amnistia-title {
  color: #222;
  font-weight: bold;
  letter-spacing: 0.5px;
}
.amnistia-container {
  max-width: 700px;
  margin: 0 auto;
  padding: 2rem 0.5rem 2.5rem 0.5rem;
}
.glass-card {
  background: rgba(255,255,255,0.95);
  border-radius: 1.2rem;
  box-shadow: 0 2px 16px #5ccedf22;
  margin-bottom: 1.2rem;
  padding: 1.2rem 1.2rem 1rem 1.2rem;
}
.amnistia-form ion-item {
  background: transparent;
  border-radius: 1rem;
  box-shadow: 0 1px 6px #5ccedf11;
  margin-bottom: 0.5rem;
}
.amnistia-card-header {
  display: flex;
  align-items: center;
  gap: 1.2rem;
  margin-bottom: 0.7rem;
}
.amnistia-avatar {
  width: 54px;
  height: 54px;
  border-radius: 50%;
  background: linear-gradient(135deg, #5ccedf 60%, #A4C9F5 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 8px #5ccedf33;
  border: 2.5px solid #fff;
}
.amnistia-avatar ion-icon {
  color: #fff !important;
  filter: drop-shadow(0 1px 2px #2ca0b899);
}
.amnistia-nombre {
  font-size: 1.2rem;
  font-weight: 600;
  color: #2ca0b8;
}
.amnistia-identidad {
  font-size: 1rem;
  color: #495057;
  opacity: 0.85;
}
.amnistia-card-content > div {
  margin-bottom: 0.3rem;
  font-size: 1rem;
}
.amnistia-alert {
  display: flex;
  align-items: center;
  gap: 1rem;
  background: #e6fff6;
  border: 1.5px solid #2dd36f44;
  color: #059669;
  margin-bottom: 1.2rem;
  padding: 1rem 1.2rem;
}
.amnistia-alert-title {
  font-weight: 700;
  font-size: 1.1rem;
  color: #059669;
}
.amnistia-alert-desc {
  font-size: 1rem;
}
.amnistia-table-card {
  padding: 1.2rem 0.5rem 0.7rem 0.5rem;
}
.amnistia-table-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: #2ca0b8;
  margin-bottom: 0.7rem;
}
.amnistia-table-responsive {
  overflow-x: auto;
}
.amnistia-table-responsive table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.98rem;
}
.amnistia-table-responsive th, .amnistia-table-responsive td {
  padding: 0.45rem 0.5rem;
  text-align: center;
}
.amnistia-table-responsive th {
  background: #e0f7fa;
  color: #2ca0b8;
  font-weight: 600;
}
.amnistia-table-responsive tr:nth-child(even) {
  background: #f8fafc;
}
.amnistia-total-row {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 1.2rem;
  font-size: 1.1rem;
  font-weight: 600;
  margin-top: 0.7rem;
  color: #2ca0b8;
}
.amnistia-total {
  font-size: 1.2rem;
  color: #059669;
  font-weight: 700;
}
.amnistia-btn-row {
  display: flex;
  justify-content: center;
  margin-top: 1.5rem;
}
.amnistia-loading {
  margin: 2.5rem 0 2rem 0;
}
@media (max-width: 600px) {
  .amnistia-container {
    padding: 1rem 0.1rem 1.5rem 0.1rem;
  }
  .glass-card {
    padding: 0.7rem 0.5rem 0.7rem 0.5rem;
    margin-bottom: 0.7rem;
  }
  .amnistia-table-title {
    font-size: 1rem;
  }
  .amnistia-table-responsive th, .amnistia-table-responsive td {
    padding: 0.3rem 0.2rem;
    font-size: 0.93rem;
  }
  .amnistia-total-row {
    font-size: 1rem;
    gap: 0.7rem;
  }
}
</style>
