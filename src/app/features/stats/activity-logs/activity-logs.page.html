<ion-header [translucent]="true" class="logs-header">
  <ion-toolbar class="header-toolbar">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/dashboard/user" icon="arrow-back-outline"></ion-back-button>
    </ion-buttons>
    <ion-title class="header-title">
      <div class="title-with-icon">
        <ion-icon name="analytics" class="header-icon"></ion-icon>
        Logs del Systema
      </div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="refreshLogs()" [disabled]="isLoading()">
        <ion-icon name="refresh-outline" [class.rotating]="isLoading()"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="logs-content">
  <!-- Pull to refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="refreshLogs($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="logs-container">
    <!-- Loading State -->
    <div class="loading-container" *ngIf="isLoading() && !activityLogs().length">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Cargando logs del sistema...</p>
    </div>

    <!-- Error State -->
    <div class="error-container" *ngIf="hasError() && !isLoading()">
      <div class="error-content">
        <ion-icon name="warning-outline" class="error-icon"></ion-icon>
        <h3>No se pudieron cargar los logs</h3>
        <p>{{ errorMessage() }}</p>
        <ion-button fill="solid" size="default" (click)="loadActivityLogs()">
          <ion-icon name="refresh-outline" slot="start"></ion-icon>
          Reintentar
        </ion-button>
      </div>
    </div>

    <!-- Logs Content -->
    <div class="logs-content-area" *ngIf="!isLoading() && !hasError() && activityLogs().length > 0">
      
      <!-- Page Header -->
      <div class="page-header">
        <h1 class="page-title">Registro de Actividad</h1>
        <!-- <p class="page-subtitle">A comprehensive list of all system activities.</p> -->
      </div>

      <!-- Filter Section -->
      <div class="filter-section">
        <ion-searchbar
          placeholder="Filtrar por Username"
          [debounce]="300"
          (ionInput)="onSearchChange($event)"
          class="username-filter">
        </ion-searchbar>
      </div>

      <!-- Logs Table -->
      <div class="logs-table-container">
        <div class="table-wrapper">
          <table class="logs-table">
            <thead>
              <tr>
                <th>FECHA</th>
                <th>CONSULTA</th>
                <th>TIPO CONSULTA</th>
                <th>PARÁMETROS</th>
                <th>RESULTADO</th>
                <th>IP</th>
                <th>DURACIÓN (MS)</th>
                <th>USUARIO</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let log of paginatedLogs(); trackBy: trackByLogId" class="log-row">
                <td class="fecha">{{ formatDate(log.createdAt) }}</td>
                <td class="tipo-consulta">{{ log.consultaType || 'N/A' }}</td>
                <td class="subtipo-consulta">{{ log.consultaSubtype || 'normal' }}</td>
                <td class="parametros">{{ formatParameters(log) }}</td>
                <td class="resultado">
                  <span class="status-badge" [class]="getResultClass(log.resultado)">
                    {{ log.resultado || 'UNKNOWN' }}
                  </span>
                  <div class="result-detail" *ngIf="log.errorMessage">
                    {{ log.errorMessage }}
                  </div>
                </td>
                <td class="ip">{{ log.ip || '::1' }}</td>
                <td class="duracion">{{ log.duracionMs || '0' }}</td>
                <td class="usuario">{{ getUserFullName(log) || 'N/A' }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="pagination-container" *ngIf="totalPages() > 1">
          <div class="pagination-info">
            <span>Showing {{ getStartRecord() }} to {{ getEndRecord() }} of {{ totalRecords() }} results</span>
          </div>
          <div class="pagination-controls">
            <ion-button 
              fill="clear" 
              class="page-button"
              [disabled]="currentPage() === 1"
              (click)="goToPage(currentPage() - 1)">
              <ion-icon name="chevron-back-outline"></ion-icon>
            </ion-button>
            
            <ion-button 
              *ngFor="let page of getVisiblePages()" 
              [class]="page === currentPage() ? 'page-button active' : 'page-button'"
              (click)="goToPage(page)">
              {{ page }}
            </ion-button>
            
            <span *ngIf="shouldShowEllipsis()" class="ellipsis">...</span>
            
            <ion-button 
              *ngIf="totalPages() > 5 && currentPage() < totalPages() - 2"
              class="page-button"
              (click)="goToPage(totalPages())">
              {{ totalPages() }}
            </ion-button>
            
            <ion-button 
              fill="clear" 
              class="page-button"
              [disabled]="currentPage() === totalPages()"
              (click)="goToPage(currentPage() + 1)">
              <ion-icon name="chevron-forward-outline"></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!isLoading() && !hasError() && activityLogs().length === 0">
      <ion-icon name="document-outline"></ion-icon>
      <h3>No hay logs disponibles</h3>
      <p>No se encontraron logs de actividad</p>
      <ion-button fill="outline" (click)="loadActivityLogs()">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        Actualizar
      </ion-button>
    </div>

  </div>
</ion-content>