<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/mercados"></ion-back-button>
    </ion-buttons>
    <ion-title>Detalle del Mercado</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="container mx-auto p-4" *ngIf="!isLoading() && mercado(); else loading">
    <!-- Información Principal -->
    <ion-card>
      <ion-card-header>
        <div class="flex justify-between items-start">
          <div>
            <ion-card-title class="text-xl font-bold">
              {{ mercado()?.nombre_mercado }}
            </ion-card-title>
            <ion-badge 
              [color]="getStatusColor(mercado()?.isActive || false)"
              class="mt-2">
              {{ getStatusText(mercado()?.isActive || false) }}
            </ion-badge>
          </div>
          <ion-icon name="business-outline" size="large" color="primary"></ion-icon>
        </div>
      </ion-card-header>
      
      <ion-card-content>
        <ion-item>
          <ion-icon name="location-outline" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Dirección</h3>
            <p>{{ mercado()?.direccion }}</p>
          </ion-label>
        </ion-item>

        <ion-item *ngIf="mercado()?.descripcion">
          <ion-icon name="business-outline" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Descripción</h3>
            <p>{{ mercado()?.descripcion }}</p>
          </ion-label>
        </ion-item>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
          <ion-item>
            <ion-label>
              <h3>Latitud</h3>
              <p>{{ mercado()?.latitud }}</p>
            </ion-label>
          </ion-item>

          <ion-item>
            <ion-label>
              <h3>Longitud</h3>
              <p>{{ mercado()?.longitud }}</p>
            </ion-label>
          </ion-item>
        </div>

        <ion-item>
          <ion-icon name="calendar-outline" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Fecha de Creación</h3>
            <p>{{ formatDate(mercado()?.createdAt!) }}</p>
          </ion-label>
        </ion-item>

        <ion-item>
          <ion-icon name="calendar-outline" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Última Actualización</h3>
            <p>{{ formatDate(mercado()?.updatedAt!) }}</p>
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Estadísticas -->
    <ion-card *ngIf="mercado()?._count">
      <ion-card-header>
        <ion-card-title class="flex items-center">
          <ion-icon name="stats-chart-outline" class="mr-2" color="primary"></ion-icon>
          Estadísticas
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-item>
          <ion-label>
            <h3>Total de Locales</h3>
            <p class="text-2xl font-bold text-primary">{{ mercado()?._count?.locales || 0 }}</p>
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Acciones Rápidas -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Acciones</ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <ion-button 
            expand="block" 
            fill="outline"
            (click)="viewInMap()">
            <ion-icon name="map-outline" slot="start"></ion-icon>
            Ver en Mapa
          </ion-button>

          <ion-button 
            expand="block" 
            fill="outline"
            (click)="viewLocales()">
            <ion-icon name="list-outline" slot="start"></ion-icon>
            Ver Locales
          </ion-button>

          <ion-button 
            expand="block" 
            color="primary"
            (click)="editMercado()">
            <ion-icon name="create-outline" slot="start"></ion-icon>
            Editar
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <ng-template #loading>
    <div class="flex justify-center items-center h-full">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
    </div>
  </ng-template>

  <!-- FAB Button -->
  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button (click)="editMercado()" color="primary">
      <ion-icon name="create-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
