<ion-header class="device-list-header">
  <div class="device-safe-area-spacer"></div>
  <ion-toolbar class="device-list-toolbar">
    <div class="header-content">
      <div class="header-left">
        <ion-icon name="bluetooth" class="header-icon"></ion-icon>
        <ion-title class="device-list-title">Seleccionar Dispositivo</ion-title>
      </div>
      <ion-buttons slot="end">
        <ion-button (click)="closeModal()" class="close-button" fill="clear">
          <ion-icon name="close" slot="icon-only"></ion-icon>
        </ion-button>
      </ion-buttons>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content class="device-list-content">
  <!-- Dispositivos Emparejados -->
  <div *ngIf="pairedDevices.length > 0" class="device-section">
    <div class="section-header paired-header">
      <h3>Dispositivos Emparejados</h3>
      <ion-note>Listos para conectar</ion-note>
    </div>
    
    <ion-list class="paired-devices-list">
      <ion-item
        button
        class="device-item paired-device"
        *ngFor="let device of pairedDevices"
        (click)="selectDevice(device)"
      >
        <div class="device-icon paired-icon" slot="start">
          <ion-icon name="bluetooth"></ion-icon>
        </div>
        <ion-label>
          <h2>{{ device.name || 'Dispositivo sin nombre' }}</h2>
          <p>{{ device.address }}</p>
          <div class="device-status">
            <ion-icon name="checkmark-circle" color="success"></ion-icon>
            <span>Emparejado</span>
          </div>
        </ion-label>
        <ion-icon name="chevron-forward" slot="end" color="medium"></ion-icon>
      </ion-item>
    </ion-list>
  </div>

  <!-- Dispositivos Nuevos -->
  <div class="device-section">
    <div class="section-header unpaired-header">
      <h3>Dispositivos Disponibles</h3>
      <div class="scanning-status">
        <ion-spinner *ngIf="isLoadingUnpaired" name="crescent" class="small-spinner"></ion-spinner>
        <ion-note *ngIf="isLoadingUnpaired">Escaneando...</ion-note>
        <ion-note *ngIf="!isLoadingUnpaired && unpairedDevices.length === 0">No se encontraron dispositivos nuevos</ion-note>
        <ion-note *ngIf="!isLoadingUnpaired && unpairedDevices.length > 0">{{ unpairedDevices.length }} dispositivo(s) encontrado(s)</ion-note>
      </div>
    </div>
    
    <ion-list *ngIf="unpairedDevices.length > 0" class="unpaired-devices-list">
      <ion-item
        button
        class="device-item unpaired-device"
        *ngFor="let device of unpairedDevices"
        (click)="selectDevice(device)"
      >
        <div class="device-icon unpaired-icon" slot="start">
          <ion-icon name="bluetooth-outline"></ion-icon>
        </div>
        <ion-label>
          <h2>{{ device.name || 'Dispositivo sin nombre' }}</h2>
          <p>{{ device.address }}</p>
          <div class="device-status">
            <ion-icon name="radio-button-off" color="medium"></ion-icon>
            <span>Nuevo dispositivo</span>
          </div>
        </ion-label>
        <ion-icon name="chevron-forward" slot="end" color="medium"></ion-icon>
      </ion-item>
    </ion-list>
  </div>

  <!-- Estado de carga inicial -->
  <div *ngIf="isLoading && pairedDevices.length === 0" class="ion-text-center ion-padding loading-state">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Cargando dispositivos...</p>
  </div>

  <!-- Mensaje cuando no hay dispositivos -->
  <div *ngIf="!isLoading && pairedDevices.length === 0 && unpairedDevices.length === 0" class="ion-text-center ion-padding no-devices-state">
    <ion-icon name="bluetooth-outline" class="no-devices-icon"></ion-icon>
    <h3>No se encontraron dispositivos</h3>
    <p>Asegúrese de que:</p>
    <ul class="troubleshooting-list">
      <li>Bluetooth esté habilitado</li>
      <li>La impresora esté encendida</li>
      <li>La impresora esté en modo de emparejamiento</li>
      <li>Esté cerca del dispositivo (menos de 10 metros)</li>
    </ul>
  </div>
</ion-content>
